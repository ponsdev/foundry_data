{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///./src/df-scene-journal.ts","webpack:///../common/Settings.ts","webpack:///./src/df-scene-nav.ts","webpack:///./src/df-scene-thumb.ts","webpack:///./src/df-scene-ratio.ts","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./src/df-scene-enhance.ts"],"sourcesContent":["import SETTINGS from \"../../common/Settings\";\n\ninterface Button {\n\ticon: string,\n\tlabel: string,\n\tcallback: AnyFunction\n}\n\nexport default class DFSceneJournal {\n\tstatic ON_CLICK_JOURNAL = 'nav-on-click-journal';\n\tstatic ON_CLICK_JOURNAL_ONLY_ONE = 'nav-on-click-journal-only-one';\n\n\tstatic async displayDialog(scene: Scene) {\n\t\tconst permScene = scene.testUserPermission(game.user, \"LIMITED\");\n\t\tconst hasConfig = game.user.isGM;\n\t\tconst hasJournal = !!scene.journal && scene.journal.testUserPermission(game.user, \"OBSERVER\");\n\t\tif (!permScene && !hasConfig && !hasJournal)\n\t\t\treturn ui.notifications.warn(`You do not have permission to view this ${scene.documentName}.`);\n\n\t\tconst buttons: Record<string, Button> = {};\n\t\tlet defaultButton = '';\n\t\tif (hasConfig) {\n\t\t\tdefaultButton = 'config';\n\t\t\tbuttons.config = {\n\t\t\t\ticon: '<i class=\"fas fa-cog\"></i>',\n\t\t\t\tlabel: game.i18n.localize('DF-SCENE-ENHANCE.Dialog.JournalConfig'),\n\t\t\t\tcallback: async () => { return scene.sheet.render(true); }\n\t\t\t};\n\t\t}\n\t\tif (hasJournal) {\n\t\t\tdefaultButton = 'journal';\n\t\t\tbuttons.journal = {\n\t\t\t\ticon: '<i class=\"fas fa-book-open\"></i>',\n\t\t\t\tlabel: game.i18n.localize('DF-SCENE-ENHANCE.Dialog.JournalJournal'),\n\t\t\t\tcallback: async () => { return scene.journal.sheet.render(true); }\n\t\t\t};\n\t\t}\n\t\tif (permScene) {\n\t\t\tdefaultButton = 'navigate';\n\t\t\tbuttons.navigate = {\n\t\t\t\ticon: '<i class=\"fas fa-directions\"></i>',\n\t\t\t\tlabel: game.i18n.localize('DF-SCENE-ENHANCE.Dialog.JournalNavigate'),\n\t\t\t\tcallback: async () => { return scene.view(); }\n\t\t\t};\n\t\t}\n\n\t\t// if there is only one option, execute it and return\n\t\tconst immediateIfOnlyOne = SETTINGS.get(DFSceneJournal.ON_CLICK_JOURNAL_ONLY_ONE);\n\t\tif (immediateIfOnlyOne && Object.keys(buttons).length == 1)\n\t\t\treturn buttons[Object.keys(buttons)[0]].callback();\n\n\t\treturn (new Dialog({\n\t\t\ttitle: game.i18n.localize(\"DF-SCENE-ENHANCE.Dialog.JournalTitle\") + scene.name,\n\t\t\tcontent: \"<p>\" + game.i18n.localize(\"DF-SCENE-ENHANCE.Dialog.JournalMessage\") + \"</p>\",\n\t\t\tbuttons: buttons as any,\n\t\t\tdefault: defaultButton,\n\t\t})).render(true);\n\t}\n\n\t/**\n\t * This is copied directly from the `TextEditor._onClickEntityLink` static method. It is only\n\t * modified for `Target 2` to display a dialog for navigation.\n\t */\n\tstatic async _onClickContentLink(event: JQuery.ClickEvent) {\n\t\tconst a = event.currentTarget;\n\t\tlet document = null;\n\t\tconst id = a.dataset.id;\n\t\tif (!a.dataset.pack) {\n\t\t\tconst collection = game.collections.get(a.dataset.entity);\n\t\t\tdocument = collection.get(id);\n\t\t\tif ((document.documentName === \"Scene\")) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn DFSceneJournal.displayDialog(document);\n\t\t\t}\n\t\t}\n\t\t// @ts-ignore\n\t\treturn TextEditor._onClickContentLink(event);\n\t}\n\n\tstatic patchTextEditor(newValue?: boolean) {\n\t\tlet journalClick = SETTINGS.get(DFSceneJournal.ON_CLICK_JOURNAL);\n\t\tif (newValue !== undefined) {\n\t\t\tjournalClick = newValue;\n\t\t}\n\t\tconst body = $(\"body\");\n\t\tif (journalClick) {\n\t\t\tbody.off(\"click\", \"a.content-link\", (TextEditor as any)._onClickContentLink);\n\t\t\tbody.on(\"click\", \"a.content-link\", DFSceneJournal._onClickContentLink);\n\t\t}\n\t\telse {\n\t\t\tbody.off(\"click\", \"a.content-link\", DFSceneJournal._onClickContentLink);\n\t\t\tbody.on(\"click\", \"a.content-link\", (TextEditor as any)._onClickContentLink);\n\t\t}\n\t}\n\n\tstatic init() {\n\t\tSETTINGS.register(DFSceneJournal.ON_CLICK_JOURNAL, {\n\t\t\tname: \"DF-SCENE-ENHANCE.Nav.SettingOnClickJournal\",\n\t\t\thint: \"DF-SCENE-ENHANCE.Nav.SettingOnClickJournalHint\",\n\t\t\tscope: \"world\",\n\t\t\tconfig: true,\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t\tonChange: (value: boolean) => DFSceneJournal.patchTextEditor(value)\n\t\t});\n\t\tSETTINGS.register(DFSceneJournal.ON_CLICK_JOURNAL_ONLY_ONE, {\n\t\t\tname: \"DF-SCENE-ENHANCE.Nav.SettingOnClickJournalOnlyOne\",\n\t\t\thint: \"DF-SCENE-ENHANCE.Nav.SettingOnClickJournalOnlyOneHint\",\n\t\t\tscope: \"scene\",\n\t\t\tconfig: true,\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t});\n\t}\n\n\tstatic ready() {\n\t\tDFSceneJournal.patchTextEditor();\n\t}\n}","\ndeclare global {\n\tinterface LenientGlobalVariableTypes {\n\t\tgame: never;\n\t\tcanvas: never;\n\t}\n\tinterface String {\n\t\t/** Localizes the string via the global `game.i18n.localize()` function. */\n\t\tlocalize(): string\n\t}\n\ttype AnyFunction = (...args: any) => any;\n}\n\nexport default class SETTINGS {\n\tstatic MOD_NAME: string;\n\tstatic init(moduleName: string) {\n\t\tthis.MOD_NAME = moduleName;\n\t\tif (!String.prototype.localize) {\n\t\t\tString.prototype.localize = function () {\n\t\t\t\treturn game.i18n.localize(this.valueOf());\n\t\t\t};\n\t\t}\n\t}\n\tstatic register<T>(key: string, config: ClientSettings.PartialSetting<T>) { game.settings.register(SETTINGS.MOD_NAME, key, config); }\n\tstatic registerMenu(key: string, config: ClientSettings.PartialMenuSetting) { game.settings.registerMenu(SETTINGS.MOD_NAME, key, config); }\n\tstatic get<T>(key: string): T { return <T>game.settings.get(SETTINGS.MOD_NAME, key); }\n\tstatic async set<T>(key: string, value: T): Promise<T> { return await game.settings.set(SETTINGS.MOD_NAME, key, value); }\n\tstatic default<T>(key: string): T { return <T>game.settings.settings.get(SETTINGS.MOD_NAME + '.' + key).default; }\n\t/** helper for referencing a Typed constructor for the `type` field of a setting { type: SETTINGS.typeOf<MyClass>() } */\n\tstatic typeOf<T>(): ConstructorOf<T> { return Object as any; }\n}\n","import SETTINGS from \"../../common/Settings\";\n\ninterface ContextOption {\n\tname: string;\n\ticon: string;\n\tcondition?: (li: JQuery<HTMLLIElement>) => boolean;\n\tcallback: ((li: JQuery<HTMLLIElement>) => Promise<unknown>) | ((li: JQuery<HTMLLIElement>) => void)\n}\n\nexport default class DFSceneNav {\n\tprivate static readonly ON_CLICK = 'nav-on-click';\n\tprivate static readonly ON_CLICK_PLAYER = 'nav-on-click-player';\n\tprivate static readonly SCENE_NAV_REAL_NAME = 'nav-label-type';\n\n\tstatic patchSceneDirectoryClick(newValue?: boolean, isPlayer?: boolean) {\n\t\tlet gmClick = SETTINGS.get(DFSceneNav.ON_CLICK);\n\t\tlet pcClick = SETTINGS.get(DFSceneNav.ON_CLICK_PLAYER);\n\t\tif (newValue !== undefined) {\n\t\t\tif (isPlayer) pcClick = newValue;\n\t\t\telse gmClick = newValue;\n\t\t}\n\n\t\t// Determine our enabled state\n\t\tconst enabled = (game.user.isGM && gmClick) || (!game.user.isGM && pcClick);\n\t\tif (enabled) {\n\t\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'SceneDirectory.prototype._onClickDocumentName', this._onClickDocumentName, 'MIXED');\n\t\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'SceneDirectory.prototype._getEntryContextOptions', this._getEntryContextOptions, 'WRAPPER');\n\t\t} else {\n\t\t\tlibWrapper.unregister(SETTINGS.MOD_NAME, 'SceneDirectory.prototype._onClickDocumentName', false);\n\t\t\tlibWrapper.unregister(SETTINGS.MOD_NAME, 'SceneDirectory.prototype._getEntryContextOptions', false);\n\t\t}\n\t}\n\n\tprivate static _onClickDocumentName(this: SceneDirectory, wrapper: AnyFunction, event: JQuery.ClickEvent) {\n\t\tevent.preventDefault();\n\t\tconst entity = SceneDirectory.collection.get(event.currentTarget.parentElement.dataset.documentId);\n\t\tif (entity instanceof Scene) entity.view();\n\t\telse wrapper(event);\n\t}\n\n\tprivate static _getEntryContextOptions(wrapper: AnyFunction, ...args: any) {\n\t\tconst options: ContextOption[] = wrapper(...args);\n\t\tif (!game.user.isGM) {\n\t\t\toptions.push({\n\t\t\t\tname: \"SCENES.View\",\n\t\t\t\ticon: '<i class=\"fas fa-eye\"></i>',\n\t\t\t\tcondition: li => !canvas.ready || (li.data(\"entityId\") !== (canvas as Canvas).scene.id),\n\t\t\t\tcallback: li => {\n\t\t\t\t\tconst scene = game.scenes.get(li.data(\"entityId\"));\n\t\t\t\t\tscene.view();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn options;\n\t}\n\n\tstatic patchSceneDirectory() {\n\t\tconst defaultOptions = duplicate(SceneDirectory.defaultOptions);\n\t\tObject.defineProperty(SceneDirectory, 'defaultOptions', {\n\t\t\tget: function () {\n\t\t\t\tconst options = mergeObject(defaultOptions, {\n\t\t\t\t\ttemplate: `modules/${SETTINGS.MOD_NAME}/templates/scene-directory.hbs`,\n\t\t\t\t});\n\t\t\t\treturn options;\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic patchSidebar() {\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'Sidebar.prototype._render', async function (this: Sidebar, wrapper: AnyFunction, force: boolean, options = {}) {\n\t\t\tif (!SETTINGS.get(DFSceneNav.ON_CLICK_PLAYER))\n\t\t\t\treturn wrapper(force, options);\n\t\t\t/************** COPIED FROM Sidebar.prototype._render *************/\n\t\t\t// Render the Sidebar container only once\n\t\t\t// @ts-expect-error\n\t\t\tif (!this.rendered) await Application.prototype._render.apply(this, [force, options]);\n\n\t\t\t// Define the sidebar tab names to render\n\t\t\tconst tabs = [\"chat\", \"combat\", \"actors\", \"items\", \"journal\", \"tables\", \"cards\", \"playlists\", \"compendium\", \"settings\"];\n\t\t\tif (game.user.isGM || SETTINGS.get(DFSceneNav.ON_CLICK_PLAYER)) tabs.push(\"scenes\");\n\n\t\t\t// Render sidebar Applications\n\t\t\tfor (const [name, app] of Object.entries(this.tabs)) {\n\t\t\t\t// @ts-expect-error\n\t\t\t\tapp._render(true).catch(err => {\n\t\t\t\t\t// @ts-expect-error\n\t\t\t\t\tHooks.onError(\"Sidebar#_render\", err, {\n\t\t\t\t\t\tmsg: `Failed to render Sidebar tab ${name}`,\n\t\t\t\t\t\tlog: \"error\",\n\t\t\t\t\t\tname\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\t/******************************************************************/\n\t\t}, 'MIXED');\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'SceneDirectory.prototype._render', async function (this: SceneDirectory, wrapper: AnyFunction, ...args: any) {\n\t\t\tif (!SETTINGS.get(DFSceneNav.ON_CLICK_PLAYER)) return wrapper(...args);\n\t\t\t// @ts-expect-error\n\t\t\treturn SidebarDirectory.prototype._render.apply(this, <any>[...args]);\n\t\t}, 'MIXED');\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'Sidebar.prototype.getData', (wrapper: (options: any) => Sidebar.Data, options: any) => {\n\t\t\treturn mergeObject(wrapper(options), { scenesAllowed: game.user.isGM || SETTINGS.get(DFSceneNav.ON_CLICK_PLAYER) });\n\t\t}, 'WRAPPER');\n\t\tconst sidebarDefaultOptions = Object.getOwnPropertyDescriptor(Sidebar, 'defaultOptions');\n\t\tObject.defineProperty(Sidebar, 'defaultOptions', {\n\t\t\tget: function () {\n\t\t\t\treturn mergeObject(sidebarDefaultOptions.get(), {\n\t\t\t\t\ttemplate: `modules/${SETTINGS.MOD_NAME}/templates/sidebar.hbs`\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\tstatic init() {\n\t\tSETTINGS.register(DFSceneNav.ON_CLICK, {\n\t\t\tname: \"DF-SCENE-ENHANCE.Nav.SettingOnClick\",\n\t\t\thint: \"DF-SCENE-ENHANCE.Nav.SettingOnClickHint\",\n\t\t\tscope: \"world\",\n\t\t\tconfig: true,\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t\tonChange: (value: boolean) => DFSceneNav.patchSceneDirectoryClick(value, false)\n\t\t});\n\t\tSETTINGS.register(DFSceneNav.ON_CLICK_PLAYER, {\n\t\t\tname: \"DF-SCENE-ENHANCE.Nav.SettingOnClickPC\",\n\t\t\thint: \"DF-SCENE-ENHANCE.Nav.SettingOnClickPCHint\",\n\t\t\tscope: \"world\",\n\t\t\tconfig: true,\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t\tonChange: (value: boolean) => DFSceneNav.patchSceneDirectoryClick(value, true)\n\t\t});\n\n\t\tSETTINGS.register(DFSceneNav.SCENE_NAV_REAL_NAME, {\n\t\t\tname: 'DF-SCENE-ENHANCE.Nav.SettingRealName',\n\t\t\thint: 'DF-SCENE-ENHANCE.Nav.SettingRealNameHint',\n\t\t\tscope: 'world',\n\t\t\tconfig: true,\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t\tonChange: () => {\n\t\t\t\tDFSceneNav.patchSceneNavGetData();\n\t\t\t\tui.nav.render(false);\n\t\t\t}\n\t\t});\n\n\t\tHandlebars.registerHelper('dfCheck', function (scene) {\n\t\t\treturn ((game.user && game.user.isGM) || !scene.data.navName) ? scene.data.name : scene.data.navName;\n\t\t});\n\n\t\tDFSceneNav.patchSceneDirectory();\n\t\tDFSceneNav.patchSidebar();\n\t\tDFSceneNav.patchSceneNavGetData();\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'SceneNavigation.prototype.activateListeners', DFSceneNav.SceneNavigation_activateListeners, 'WRAPPER');\n\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'SceneNavigation.prototype._getContextMenuOptions', DFSceneNav.SceneNavigation_getContextMenuOptions, 'WRAPPER');\n\t}\n\n\tstatic ready() {\n\t\tDFSceneNav.patchSceneDirectoryClick();\n\t}\n\n\n\tprivate static patchSceneNavGetData() {\n\t\tif (SETTINGS.get(DFSceneNav.SCENE_NAV_REAL_NAME))\n\t\t\tlibWrapper.register(SETTINGS.MOD_NAME, 'SceneNavigation.prototype.getData', this.SceneNavigation_getData, 'WRAPPER');\n\t\telse\n\t\t\tlibWrapper.unregister(SETTINGS.MOD_NAME, 'SceneNavigation.prototype.getData', false);\n\t}\n\tprivate static SceneNavigation_getData(this: SceneNavigation, wrapper: AnyFunction, _options: any) {\n\t\tconst data: {\n\t\t\tcollapsed: boolean,\n\t\t\tscenes: Scene[]\n\t\t} = wrapper(_options);\n\t\tfor (const scene of data.scenes) {\n\t\t\t// @ts-expect-error\n\t\t\tscene.name = game.scenes.get(scene._id).name;\n\t\t}\n\t\treturn data;\n\t}\n\n\tprivate static SceneNavigation_activateListeners(this: SceneNavigation, wrapper: (html: JQuery) => void, html: JQuery) {\n\t\twrapper(html);\n\t\thtml.find('li.scene.nav-item').each((_, element) => {\n\t\t\tconst scene = game.scenes.get(element.getAttribute('data-scene-id'));\n\n\t\t\t// Players will get a tooltip if the nav name is longer than 32 characters\n\t\t\tif (!game.user.isGM) {\n\t\t\t\tconst title = scene.data.navName ?? scene.data.name;\n\t\t\t\tif (title.length > 32)\n\t\t\t\t\telement.title = scene.data.navName ?? scene.data.name;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Don't add a title if there is no Nav Name\n\t\t\tif (!scene.data.navName || scene.data.navName.trim().length === 0) return;\n\t\t\t// If we are displaying the scene's Real Name\n\t\t\tif (SETTINGS.get(DFSceneNav.SCENE_NAV_REAL_NAME))\n\t\t\t\telement.title = 'DF-SCENE-ENHANCE.Nav.Tooltip_PC'.localize() + scene.data.navName;\n\t\t\telse\n\t\t\t\telement.title = scene.data.name;\n\t\t});\n\t}\n\n\tprivate static SceneNavigation_getContextMenuOptions(this: SceneNavigation, wrapper: AnyFunction) {\n\t\tconst options = <ContextOption[]>wrapper();\n\t\toptions.push({\n\t\t\tname: 'DF-SCENE-ENHANCE.Nav.ContextOptions.SetView',\n\t\t\ticon: '<i class=\"fas fa-crop-alt fa-fw\"></i>',\n\t\t\tcondition: li => game.user.isGM && game.scenes.get(li.attr('data-scene-id')).isView,\n\t\t\tcallback: async li => {\n\t\t\t\tconst scene = game.scenes.get(li.attr('data-scene-id'));\n\t\t\t\tawait scene.update({\n\t\t\t\t\tinitial: {\n\t\t\t\t\t\tx: parseInt(<any>canvas.stage.pivot.x),\n\t\t\t\t\t\ty: parseInt(<any>canvas.stage.pivot.y),\n\t\t\t\t\t\tscale: canvas.stage.scale.x\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tui.notifications.info(\"DF-SCENE-ENHANCE.Nav.ContextOptions.SetViewConfirmation\".localize());\n\t\t\t}\n\t\t}, {\n\t\t\tname: 'DF-SCENE-ENHANCE.Nav.ContextOptions.ConfigGrid',\n\t\t\ticon: '<i class=\"fas fa-ruler-combined\"></i>',\n\t\t\tcondition: li => game.user.isGM && game.scenes.get(li.attr('data-scene-id')).isView,\n\t\t\tcallback: li => {\n\t\t\t\tconst scene = game.scenes.get(li.attr('data-scene-id'));\n\t\t\t\tconst gridConfig = new GridConfig(scene, <any>{\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-empty-function\n\t\t\t\t\tmaximize: () => {}\n\t\t\t\t});\n\t\t\t\treturn gridConfig.render(true);\n\t\t\t}\n\t\t});\n\t\treturn options;\n\t}\n}\n","import DFSceneRatio from \"./df-scene-ratio\";\nimport SETTINGS from \"../../common/Settings\";\n\nexport default class DFSceneThumb {\n\tstatic MODULE = 'df-scene-enhance';\n\tstatic THUMBS = 'thumbs';\n\tstatic purge() {\n\t\tif (!game.user.isGM) return;\n\t\tconst ids: string[] = [];\n\t\tfor (const scene of game.scenes.values() as any as Scene[]) {\n\t\t\tids.push(scene.id);\n\t\t}\n\t\tconst config = JSON.parse(SETTINGS.get(DFSceneThumb.THUMBS));\n\t\tfor (const id in config) {\n\t\t\tif (!ids.includes(id))\n\t\t\t\tdelete config[id];\n\t\t}\n\t\tSETTINGS.set(DFSceneThumb.THUMBS, JSON.stringify(config));\n\t}\n\tstatic updateThumb(sceneId: string, value?: string, generated: boolean = false) {\n\t\tconst config = JSON.parse(SETTINGS.get(DFSceneThumb.THUMBS));\n\t\tif (!value) delete config[sceneId];\n\t\telse config[sceneId] = { url: value, thumb: generated };\n\t\tSETTINGS.set(DFSceneThumb.THUMBS, JSON.stringify(config));\n\t}\n\tstatic getThumb(sceneId: string) {\n\t\treturn JSON.parse(SETTINGS.get(DFSceneThumb.THUMBS))[sceneId] ?? null;\n\t}\n\n\tstatic init() {\n\t\tSETTINGS.register(DFSceneThumb.THUMBS, {\n\t\t\tscope: \"world\",\n\t\t\tconfig: false,\n\t\t\ttype: String,\n\t\t\tdefault: \"{}\"\n\t\t});\n\t\tHooks.on('renderSceneConfig', async (app: SceneConfig, html: JQuery<HTMLElement>, data: SceneConfig.Data) => {\n\t\t\tconst imgInput = html.find('input[name =\"img\"]')[0];\n\t\t\tif (!imgInput || !imgInput.parentElement || !imgInput.parentElement.parentElement) return;\n\t\t\tconst sceneId = data.document.id;\n\t\t\tconst thumbConfig = DFSceneThumb.getThumb(sceneId);\n\t\t\tconst injection = $(await renderTemplate(`modules/${DFSceneThumb.MODULE}/templates/scene-thumb.hbs`, { thumbPath: (thumbConfig && thumbConfig.url) || \"\" }));\n\t\t\tconst target = imgInput.parentElement.parentElement;\n\t\t\tfor (let c = 0; c < injection.length; c++) {\n\t\t\t\tif (injection[c].nodeType != 1) continue;\n\t\t\t\ttarget.after(injection[c]);\n\t\t\t}\n\t\t\thtml.find('#df-thumb-btn').on('click', () => {\n\t\t\t\tconst fp = FilePicker.fromButton(html.find('#df-thumb-btn')[0] as HTMLButtonElement);\n\t\t\t\tapp.filepickers.push(fp);\n\t\t\t\tfp.browse('');\n\t\t\t});\n\t\t\thtml.find('#df-thumb-img').on('change', () => DFSceneThumb.updateThumb(sceneId, html.find('#df-thumb-img').val() as string));\n\t\t\t// @ts-ignore\n\t\t\tapp.ratioScaler = new DFSceneRatio();\n\t\t\t// @ts-ignore\n\t\t\tawait (<DFSceneRatio>app.ratioScaler).render(app, html, data);\n\t\t});\n\t\tHooks.on('closeSceneConfig', async (app: SceneConfig, _: JQuery<HTMLElement>) => {\n\t\t\tconst dfSceneConfig = DFSceneThumb.getThumb(app.document.id);\n\t\t\tconst scene: Scene = app.object;\n\t\t\tif (!dfSceneConfig || !dfSceneConfig.url) return;\n\t\t\t// Update thumbnail and image dimensions\n\t\t\ttry {\n\t\t\t\tconst img = (dfSceneConfig && dfSceneConfig.url) ?? scene.data.img;\n\t\t\t\tconst td = await ImageHelper.createThumbnail(img, { width: 300, height: 100 });\n\t\t\t\tdfSceneConfig.thumb = true;\n\t\t\t\tDFSceneThumb.updateThumb(scene.id, img, true);\n\t\t\t\tawait scene.update({ thumb: td.thumb } as any, {});\n\t\t\t} catch (err: any) {\n\t\t\t\tconsole.error(\"Thumbnail Override generation for Scene failed\", err);\n\t\t\t\tui.notifications.error(\"Thumbnail Override generation for Scene failed: \" + err.message);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic ready() {\n\t\tDFSceneThumb.purge();\n\t}\n}","\n// Reduce a fraction by finding the Greatest Common Divisor and dividing by it.\nfunction reduce(numerator: number, denominator: number) {\n\tlet a = numerator;\n\tlet b = denominator;\n\tlet c;\n\twhile (b) {\n\t\tc = a % b; a = b; b = c;\n\t}\n\treturn [numerator / a, denominator / a];\n}\nfunction floatVal(input: JQuery<HTMLElement>) {\n\treturn parseFloat(input.val() as string);\n}\nfunction intVal(input: JQuery<HTMLElement>) {\n\treturn parseInt(input.val() as string);\n}\n\nexport default class DFSceneRatio {\n\tstatic MODULE = 'df-scene-enhance';\n\n\tinitialWidth = 0;\n\tinitialHeight = 0;\n\n\twidthField: JQuery<HTMLInputElement> = null;\n\theightField: JQuery<HTMLInputElement> = null;\n\tlockRatio: JQuery<HTMLInputElement> = null;\n\tcustomRatio: JQuery<HTMLInputElement> = null;\n\tnumerator: JQuery<HTMLInputElement> = null;\n\tdenominator: JQuery<HTMLInputElement> = null;\n\tapplyRatio: JQuery<HTMLElement> = null;\n\tscale: JQuery<HTMLInputElement> = null;\n\tapplyScale: JQuery<HTMLElement> = null;\n\n\tisLocked: boolean = false;\n\tuseCustom: boolean = false;\n\n\n\tget _width(): number { return intVal(this.widthField); }\n\tset _width(value: number) { this.widthField.val(value); }\n\tget _height(): number { return intVal(this.heightField); }\n\tset _height(value: number) { this.heightField.val(value); }\n\n\tget _numerator(): number { return floatVal(this.numerator); }\n\tset _numerator(value: number) { this.numerator.val(value); }\n\tget _denominator(): number { return floatVal(this.denominator); }\n\tset _denominator(value: number) { this.denominator.val(value); }\n\n\tget _scale() { return floatVal(this.scale); }\n\tset _scale(value) { this.scale.val(value); }\n\n\n\t// _updateScale() {\n\t// \tthis.scale.val(((this._width / this.initialWidth) + (this._height / this.initialHeight)) / 2.0);\n\t// }\n\t_updateRatio() {\n\t\tconst [num, den] = reduce(this._width, this._height);\n\t\tthis._numerator = num;\n\t\tthis._denominator = den;\n\t}\n\n\t_performDimensionChange(width?: number, height?: number) {\n\t\t// this._updateScale();\n\t\tif (!this.isLocked) {\n\t\t\tthis._updateRatio();\n\t\t\treturn;\n\t\t}\n\t\tconst num = this._numerator;\n\t\tconst den = this._denominator;\n\t\tif (isNaN(num) || isNaN(den)) return;\n\t\tif (width !== undefined)\n\t\t\tthis._height = Math.round((width / num) * den);\n\t\telse if (height !== undefined)\n\t\t\tthis._width = Math.round((height / den) * num);\n\t\telse\n\t\t\tconsole.error(\"DFSceneRatio._performDimensionChange(undefined, undefined)\");\n\t}\n\n\t_performScale() {\n\t\tconst num = this._numerator;\n\t\tconst den = this._denominator;\n\t\tconst scale = this._scale;\n\t\tif (isNaN(num) || isNaN(den) || isNaN(scale)) return;\n\t\t// if ((num == den && this._width > this._height) || num > den) {\n\t\t// \tthis._width = Math.round(this.initialWidth * scale);\n\t\t// \tthis._height = Math.round(((this.initialWidth * scale) / num) * den);\n\t\t// } else {\n\t\t// \tthis._width = Math.round(((this.initialHeight * scale) / den) * num);\n\t\t// \tthis._height = Math.round(this.initialHeight * scale);\n\t\t// }\n\t\tthis._width = this._width * scale;\n\t\tthis._height = this._height * scale;\n\t\tthis._scale = 1;\n\t}\n\n\t_performRatio() {\n\t\tconst num = this._numerator;\n\t\tconst den = this._denominator;\n\t\tconst width = this._width;\n\t\tconst height = this._height;\n\t\tif (isNaN(num) || isNaN(den)) return;\n\t\tif (num > den || (num == den && width > height)) {\n\t\t\tthis._height = Math.round((width / num) * den);\n\t\t} else {\n\t\t\tthis._width = Math.round((height / den) * num);\n\t\t}\n\t\t// this._updateScale();\n\t}\n\n\tasync render(_app: any, html: JQuery<HTMLElement>, data: any) {\n\t\tconst document = <Scene>data.document;\n\t\tthis.initialWidth = document.data.width;\n\t\tthis.initialHeight = document.data.height;\n\t\tconst dims = <Canvas.Dimensions>data.document.dimensions;\n\t\tconst [numerator, denominator] = reduce(dims.width, dims.height);\n\t\tconst ratioData = {\n\t\t\tnumerator: numerator,\n\t\t\tdenominator: denominator\n\t\t};\n\t\tconst ratioHtml = $(await renderTemplate(`modules/${DFSceneRatio.MODULE}/templates/scene-ratio.hbs`, ratioData));\n\t\tconst dimHtml = html.find('input[name=\"padding\"]').parent().parent().prev();\n\t\tthis.widthField = dimHtml.find('input[name=\"width\"]') as JQuery<HTMLInputElement>;\n\t\tthis.heightField = dimHtml.find('input[name=\"height\"]') as JQuery<HTMLInputElement>;\n\t\tratioHtml.insertAfter(dimHtml);\n\t\tthis._extractFields(ratioHtml);\n\t\tthis._attachListeners();\n\t\tawait this._updateOriginalImageDimensions(document.img);\n\t}\n\t_extractFields(html: JQuery<HTMLElement>) {\n\t\tthis.lockRatio = html.find('input[name=\"lockRatio\"]') as JQuery<HTMLInputElement>;\n\t\tthis.customRatio = html.find('input[name=\"customRatio\"]') as JQuery<HTMLInputElement>;\n\t\tthis.numerator = html.find('input[name=\"numerator\"]') as JQuery<HTMLInputElement>;\n\t\tthis.denominator = html.find('input[name=\"denominator\"]') as JQuery<HTMLInputElement>;\n\t\tthis.applyRatio = html.find('button[name=\"applyRatio\"]');\n\t\tthis.scale = html.find('input[name=\"scale\"]') as JQuery<HTMLInputElement>;\n\t\tthis.applyScale = html.find('button[name=\"applyScale\"]');\n\t}\n\t_attachListeners() {\n\t\tthis.widthField.on('change', () => this._performDimensionChange(this._width));\n\t\tthis.heightField.on('change', () => this._performDimensionChange(undefined, this._height));\n\n\t\tthis.lockRatio.on('change', () => { this.isLocked = this.lockRatio[0].checked; });\n\t\tthis.customRatio.on('change', () => {\n\t\t\tthis.useCustom = this.customRatio[0].checked;\n\t\t\tthis.numerator.prop('disabled', this.useCustom == false);\n\t\t\tthis.denominator.prop('disabled', this.useCustom == false);\n\t\t\tthis.applyRatio.prop('disabled', this.useCustom == false);\n\t\t});\n\t\tthis.applyScale.on('click', () => this._performScale());\n\t\tthis.applyRatio.on('click', () => this._performRatio());\n\t}\n\n\tasync _updateOriginalImageDimensions(url: string) {\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\tconst image = $(new Image());\n\t\t\timage.on('load', () => {\n\t\t\t\tthis.widthField.attr('placeholder', image[0].width);\n\t\t\t\tthis.heightField.attr('placeholder', image[0].height);\n\t\t\t\tresolve();\n\t\t\t}).on('error', reject).attr('src', url);\n\t\t});\n\t}\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import DFSceneJournal from './df-scene-journal';\nimport DFSceneNav from './df-scene-nav';\nimport DFSceneThumb from './df-scene-thumb';\nimport SETTINGS from \"../../common/Settings\";\nSETTINGS.init('df-scene-enhance');\n\nHooks.once('init', function() {\n\tDFSceneJournal.init();\n\tDFSceneNav.init();\n\tDFSceneThumb.init();\n});\nHooks.once('ready', function() {\n\tif (!game.modules.get('lib-wrapper')?.active) {\n\t\tconsole.error('Missing libWrapper module dependency');\n\t\tif (game.user.isGM)\n\t\t\tui.notifications.error(game.i18n.localize('DF-SCENE-ENHANCE.errorLibWrapperMissing'));\n\t\treturn;\n\t}\n\tDFSceneJournal.ready();\n\tDFSceneNav.ready();\n\tDFSceneThumb.ready();\n});"],"names":["DFSceneJournal","static","scene","permScene","testUserPermission","game","user","hasConfig","isGM","hasJournal","journal","ui","notifications","warn","documentName","buttons","defaultButton","config","icon","label","i18n","localize","callback","async","sheet","render","navigate","view","ON_CLICK_JOURNAL_ONLY_ONE","Object","keys","length","Dialog","title","name","content","default","event","a","currentTarget","document","id","dataset","pack","collections","get","entity","preventDefault","displayDialog","TextEditor","_onClickContentLink","newValue","journalClick","ON_CLICK_JOURNAL","undefined","body","$","off","on","hint","scope","type","Boolean","onChange","value","patchTextEditor","SETTINGS","moduleName","this","MOD_NAME","String","prototype","valueOf","key","settings","register","registerMenu","set","DFSceneNav","isPlayer","gmClick","ON_CLICK","pcClick","ON_CLICK_PLAYER","libWrapper","_onClickDocumentName","_getEntryContextOptions","unregister","wrapper","SceneDirectory","collection","parentElement","documentId","Scene","args","options","push","condition","li","canvas","ready","data","scenes","defaultOptions","duplicate","defineProperty","mergeObject","template","force","rendered","Application","_render","apply","app","entries","tabs","catch","err","Hooks","onError","msg","log","SidebarDirectory","scenesAllowed","sidebarDefaultOptions","getOwnPropertyDescriptor","Sidebar","patchSceneDirectoryClick","SCENE_NAV_REAL_NAME","patchSceneNavGetData","nav","Handlebars","registerHelper","navName","patchSceneDirectory","patchSidebar","SceneNavigation_activateListeners","SceneNavigation_getContextMenuOptions","SceneNavigation_getData","_options","_id","html","find","each","_","element","getAttribute","trim","attr","isView","update","initial","x","parseInt","stage","pivot","y","scale","info","GridConfig","maximize","DFSceneThumb","ids","values","JSON","parse","THUMBS","includes","stringify","sceneId","generated","url","thumb","imgInput","thumbConfig","getThumb","injection","renderTemplate","MODULE","thumbPath","target","c","nodeType","after","fp","FilePicker","fromButton","filepickers","browse","updateThumb","val","ratioScaler","dfSceneConfig","object","img","td","ImageHelper","createThumbnail","width","height","console","error","message","purge","reduce","numerator","denominator","b","floatVal","input","parseFloat","intVal","DFSceneRatio","initialWidth","initialHeight","widthField","heightField","lockRatio","customRatio","applyRatio","applyScale","isLocked","useCustom","_width","_height","_numerator","_denominator","_scale","_updateRatio","num","den","_performDimensionChange","isNaN","Math","round","_performScale","_performRatio","_app","dims","dimensions","ratioData","ratioHtml","dimHtml","parent","prev","insertAfter","_extractFields","_attachListeners","_updateOriginalImageDimensions","checked","prop","Promise","resolve","reject","image","Image","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","d","definition","o","enumerable","obj","hasOwnProperty","call","r","Symbol","toStringTag","once","modules","active"],"sourceRoot":""}