{"version":3,"file":"fxmaster.js","sources":["../src/constants.js","../src/logger.js","../src/utils.js","../src/migration.js","../src/settings.js","../src/hooks.js","../src/weatherEffects/effects/AbstractWeatherEffect.js","../src/weatherEffects/effects/BubblesWeatherEffect.js","../src/weatherEffects/effects/CloudsWeatherEffect.js","../src/weatherEffects/effects/EmbersWeatherEffect.js","../src/weatherEffects/effects/CrowsWeatherEffect.js","../src/weatherEffects/effects/BatsWeatherEffect.js","../src/weatherEffects/effects/FogWeatherEffect.js","../src/weatherEffects/effects/RaintopWeatherEffect.js","../src/weatherEffects/effects/RainSimpleWeatherEffect.js","../src/weatherEffects/effects/SnowstormWeatherEffect.js","../src/weatherEffects/effects/BirdsWeatherEffect.js","../src/weatherEffects/effects/StarsWeatherEffect.js","../src/weatherEffects/effects/RainWeatherEffect.js","../src/weatherEffects/effects/SnowWeatherEffect.js","../src/weatherEffects/effects/AutumnLeavesWeatherEffect.js","../src/weatherEffects/effects/SpiderWeatherEffect.js","../src/weatherEffects/effects/EaglesWeatherEffect.js","../src/weatherEffects/effects/RatsWeatherEffect.js","../src/weatherEffects/weatherDB.js","../src/filterEffects/filters/FXColorFilter.js","../src/filterEffects/filters/FXUnderwaterFilter.js","../src/canvasanimation.js","../src/ease.js","../src/filterEffects/filters/FXLightningFilter.js","../src/filterEffects/filters/FXPredatorFilter.js","../src/filterEffects/filters/FXOldFilmFilter.js","../src/filterEffects/filters/FXBloomFilter.js","../src/filterEffects/filtersDB.js","../src/config.js","../src/specialEffects/specialsDB.js","../src/weatherEffects/WeatherLayer.js","../src/pixi-helpers.js","../src/filterEffects/FilterManager.js","../src/specialEffects/applications/specials-create.js","../src/specialEffects/applications/specials-config.js","../src/specialEffects/SpecialsLayer.js","../src/base-form.js","../src/weatherEffects/applications/weather-config.js","../src/filterEffects/applications/filters-config.js","../src/macro.js","../src/controls.js","../src/shims/lib-wrapper.js","../src/wrappers/canvas.js","../src/wrappers/index.js","../src/fxmaster.js","../src/helpers.js"],"sourcesContent":["export const packageId = \"fxmaster\";\n","const loggingContext = \"FXMaster\";\nconst loggingSeparator = \"|\";\n\n/**\n * Gets a logging function for the requested log level.\n * @typedef {'debug' | 'info' | 'warn' | 'error'} LogLevel\n * @typedef {(...args: unknown[]) => void} LoggingFunction\n * @param {LogLevel} [type = 'info'] - The log level of the requested logger\n * @returns {LoggingFunction}\n */\nfunction getLoggingFunction(type = \"info\") {\n  const log = console[type];\n  return (...data) => log(loggingContext, loggingSeparator, ...data);\n}\n\n/**\n * A singleton logger object.\n */\nexport const logger = Object.freeze({\n  debug: getLoggingFunction(\"debug\"),\n  info: getLoggingFunction(\"info\"),\n  warn: getLoggingFunction(\"warn\"),\n  error: getLoggingFunction(\"error\"),\n  getLoggingFunction,\n});\n","import { packageId } from \"./constants.js\";\n\nexport const resetFlags = function (document, flaglabel, newFlags) {\n  const oldFlags = document.getFlag(packageId, flaglabel);\n  const keys = oldFlags ? Object.keys(oldFlags) : [];\n  keys.forEach((k) => {\n    if (newFlags[k]) return;\n    newFlags[`-=${k}`] = null;\n  });\n  return document.setFlag(packageId, flaglabel, newFlags);\n};\n\nexport function formatString(format, ...args) {\n  return format.replace(/{(\\d+)}/g, function (match, number) {\n    return typeof args[number] != \"undefined\" ? args[number] : match;\n  });\n}\n\nexport function isV9OrLater() {\n  return game.release?.generation ?? 0 >= 9;\n}\n\nexport function roundToDecimals(number, decimals) {\n  return Number(Math.round(number + \"e\" + decimals) + \"e-\" + decimals);\n}\n","import { packageId } from \"./constants.js\";\nimport { logger } from \"./logger.js\";\nimport { isV9OrLater, resetFlags } from \"./utils.js\";\n\nexport const targetServerMigration = 2;\nexport const targetClientMigration = 1;\n\nexport async function migrate() {\n  await migrateClient();\n  if (game.user.isGM) {\n    await migrateWolrd();\n  }\n}\n\nasync function migrateWolrd() {\n  const migration = game.settings.get(packageId, \"migration\");\n  if (migration === -1) {\n    return game.settings.set(packageId, \"migration\", targetServerMigration);\n  }\n\n  if (migration < targetServerMigration) {\n    ui.notifications.info(\"FXMASTER.MigrationWorldStart\", { localize: true, permanent: true });\n    let isError = false;\n\n    switch (migration) {\n      case 0:\n      case 1:\n        isError |= await migrateWorld1to2();\n    }\n\n    if (isError) {\n      await game.settings.set(packageId, \"disableAll\", true);\n      ui.notifications.error(\"FXMASTER.MigrationWorldCompletedWithErrors\", { localize: true, permanent: true });\n    } else {\n      ui.notifications.info(\"FXMASTER.MigrationWorldCompletedSuccessfully\", { localize: true, permanent: true });\n    }\n    await game.settings.set(packageId, \"migration\", targetServerMigration);\n  }\n}\n\nasync function migrateWorld1to2() {\n  let isError = false;\n\n  const migrateScene = async (scene) => {\n    const weatherEffects = scene.getFlag(packageId, \"effects\") ?? {};\n    if (Object.keys(weatherEffects).length > 0) {\n      const newWeatherEffects = Object.fromEntries(\n        Object.entries(weatherEffects).map(([id, effect]) => {\n          const weatherEffectClass = CONFIG.fxmaster.weather[effect.type];\n          return [id, { ...effect, options: weatherEffectClass.convertOptionsToV2(effect.options, scene) }];\n        }),\n      );\n      await resetFlags(scene, \"effects\", newWeatherEffects);\n    }\n  };\n\n  for (const scene of game.scenes) {\n    logger.debug(`Migrating Scene '${scene.name}' (${scene.id}).`);\n    try {\n      await migrateScene(scene);\n    } catch (e) {\n      logger.error(`Migration of Scene '${scene.name}' (${scene.id}) failed.`, e);\n      isError = true;\n    }\n  }\n\n  const migrateSceneCompendium = async (pack) => {\n    const type = isV9OrLater() ? pack.metadata.type : pack.metadata.entity;\n    if (type !== \"Scene\") {\n      return;\n    }\n\n    const wasLocked = pack.locked;\n    await pack.configure({ locked: false });\n\n    await pack.migrate();\n    const scenes = await pack.getDocuments();\n\n    for (const scene of scenes) {\n      logger.debug(`Migrating Scene '${scene.name}' (${scene.id}) in compendium ${pack.collection}.`);\n      try {\n        await migrateScene(scene);\n      } catch (e) {\n        logger.error(`Migration of Scene '${scene.name}' (${scene.id}) in compendium ${pack.collection} failed.`, e);\n        isError = true;\n      }\n    }\n\n    await pack.configure({ locked: wasLocked });\n  };\n\n  for (const pack of game.packs) {\n    const type = isV9OrLater() ? pack.metadata.type : pack.metadata.entity;\n    if (pack.metadata.package !== \"world\" || type !== \"Scene\") continue;\n    await migrateSceneCompendium(pack);\n  }\n\n  return isError;\n}\n\nasync function migrateClient() {\n  const migration = game.settings.get(packageId, \"clientMigration\");\n  if (migration === -1) {\n    return game.settings.set(packageId, \"clientMigration\", targetClientMigration);\n  }\n\n  if (migration < targetClientMigration) {\n    ui.notifications.info(\"FXMASTER.MigrationClientStart\", { permanent: true, localize: true });\n    let isError = false;\n\n    switch (migration) {\n      case 0:\n        isError |= await migrateClient0to1();\n    }\n\n    if (isError) {\n      ui.notifications.error(\"FXMASTER.MigrationClientCompletedWithErrors\", { localize: true, permanent: true });\n    } else {\n      ui.notifications.info(\"FXMASTER.MigrationClientCompletedSuccessfully\", { localize: true, permanent: true });\n    }\n    await game.settings.set(packageId, \"clientMigration\", targetClientMigration);\n  }\n}\n\nasync function migrateClient0to1() {\n  const effects = game.settings.get(packageId, \"specialEffects\");\n  for (let i = 0; i < effects.length; ++i) {\n    if (typeof effects[i].scale !== \"object\") {\n      effects[i].scale = {\n        x: effects[i].scale,\n        y: effects[i].scale,\n      };\n    }\n  }\n  await game.settings.set(packageId, \"specialEffects\", effects);\n  return false;\n}\n\nexport function isOnTargetMigration() {\n  return (\n    game.settings.get(packageId, \"migration\") === targetServerMigration &&\n    game.settings.get(packageId, \"clientMigration\") === targetClientMigration\n  );\n}\n\n/**\n * Schedule a callback to be executed as soon as the world has been migrated to the target migration. If it is on the\n * latest migration already, the callback is executed immediately. Callbacks are executed in the order in that they have\n * been registered.\n * @param {() => (Promise<void> | void)} callback A callback to execute when the world is migrated\n */\nexport function executeWhenWorldIsMigratedToLatest(callback) {\n  if (game.settings.get(packageId, \"migration\") !== targetServerMigration) {\n    worldMigrationCallbacks.push(callback);\n  } else {\n    callback();\n  }\n}\n\n/** @type {Array<() => (Promise<void> | void)>} */\nconst worldMigrationCallbacks = [];\n\nexport async function onWorldMigrated() {\n  if (game.settings.get(packageId, \"migration\") === targetServerMigration) {\n    for (const callback of worldMigrationCallbacks) {\n      await callback();\n    }\n  }\n}\n","import { packageId } from \"./constants.js\";\nimport { onWorldMigrated } from \"./migration.js\";\n\nexport const registerSettings = function () {\n  game.settings.register(packageId, \"enable\", {\n    name: \"FXMASTER.Enable\",\n    default: true,\n    scope: \"client\",\n    type: Boolean,\n    config: true,\n    onChange: debouncedReload,\n  });\n\n  game.settings.register(packageId, \"specialEffects\", {\n    name: \"specialEffects\",\n    default: [],\n    scope: \"world\",\n    type: Array,\n    config: false,\n  });\n\n  game.settings.register(packageId, \"migration\", {\n    name: \"migration\",\n    default: -1,\n    scope: \"world\",\n    type: Number,\n    config: false,\n    onChange: onWorldMigrated,\n  });\n\n  game.settings.register(packageId, \"clientMigration\", {\n    name: \"clientMigration\",\n    default: -1,\n    scope: \"client\",\n    type: Number,\n    config: false,\n  });\n\n  game.settings.register(packageId, \"permission-create\", {\n    name: \"FXMASTER.PermissionCreate\",\n    hint: \"FXMASTER.PermissionCreateHint\",\n    scope: \"world\",\n    config: true,\n    default: foundry.CONST.USER_ROLES.ASSISTANT,\n    type: Number,\n    choices: {\n      [foundry.CONST.USER_ROLES.PLAYER]: \"USER.RolePlayer\",\n      [foundry.CONST.USER_ROLES.TRUSTED]: \"USER.RoleTrusted\",\n      [foundry.CONST.USER_ROLES.ASSISTANT]: \"USER.RoleAssistant\",\n      [foundry.CONST.USER_ROLES.GAMEMASTER]: \"USER.RoleGamemaster\",\n    },\n    onChange: debouncedReload,\n  });\n\n  game.settings.register(packageId, \"disableAll\", {\n    name: \"FXMASTER.DisableAll\",\n    hint: \"FXMASTER.DisableAllHint\",\n    default: false,\n    scope: \"world\",\n    type: Boolean,\n    config: true,\n  });\n};\n\nconst debouncedReload = foundry.utils.debounce(() => {\n  window.location.reload();\n}, 100);\n","import { packageId } from \"./constants.js\";\nimport { logger } from \"./logger.js\";\nimport { formatString, resetFlags } from \"./utils.js\";\n\nexport const registerHooks = function () {\n  // ------------------------------------------------------------------\n  // Hooks API\n  Hooks.on(`${packageId}.switchWeather`, onSwitchWeather);\n  Hooks.on(`${packageId}.updateWeather`, onUpdateWeather);\n\n  // deprecated hooks\n  Hooks.on(\"switchWeather\", onSwitchWeatherDeprecated);\n  Hooks.on(\"updateWeather\", onUpdateWeatherDeprecated);\n};\n\n/**\n * Handle a request to toggle named a weather effect in the current scene.\n * @param {{name: string, type: string, options: object}} parameters The parameters that define the named weather effect\n */\nasync function onSwitchWeather(parameters) {\n  if (!canvas.scene) {\n    return;\n  }\n  const newEffect = { [parameters.name]: { type: parameters.type, options: parameters.options } };\n\n  let flags = (await canvas.scene.getFlag(packageId, \"effects\")) ?? {};\n  let effects = {};\n\n  if (foundry.utils.hasProperty(flags, parameters.name)) {\n    effects = flags;\n    delete effects[parameters.name];\n  } else {\n    effects = foundry.utils.mergeObject(flags, newEffect);\n  }\n  if (Object.keys(effects).length == 0) {\n    await canvas.scene.unsetFlag(packageId, \"effects\");\n  } else {\n    resetFlags(canvas.scene, \"effects\", effects);\n  }\n}\n\n/**\n * Handle a request to set the weather effects in the current scene.\n * @param {Array<object>} parametersArray The array of parameters defining the effects to be activated\n */\nasync function onUpdateWeather(parametersArray) {\n  const effects = Object.fromEntries(parametersArray.map((parameters) => [foundry.utils.randomID(), parameters]));\n  resetFlags(canvas.scene, \"effects\", effects);\n}\n\nconst deprecationFormatString =\n  \"The '{0}' hook is deprecated and will be removed in a future version. Please use the \" +\n  `'${packageId}.{0}' hook instead. Be aware that the meaning of some options changed for the new hook. ` +\n  \"Consult the documentation for more details: https://github.com/ghost-fvtt/fxmaster/blob/v2.0.0/README.md#weather-effect-options. \" +\n  \"To get the same effect for this scene, the given parameters should look as follows for the new hook:\";\n\nasync function onSwitchWeatherDeprecated(parameters) {\n  const weatherEffectClass = CONFIG.fxmaster.weather[parameters.type];\n\n  const v2Parameters = {\n    ...parameters,\n    options: weatherEffectClass.convertOptionsToV2(parameters.options, canvas.scene),\n  };\n\n  logger.warn(formatString(deprecationFormatString, \"switchWeather\"), v2Parameters);\n\n  return onSwitchWeather(v2Parameters);\n}\n\nasync function onUpdateWeatherDeprecated(parametersArray) {\n  const v2ParametersArray = parametersArray.map((parameters) => {\n    const weatherEffectClass = CONFIG.fxmaster.weather[parameters.type];\n    return {\n      ...parameters,\n      options: weatherEffectClass.convertOptionsToV2(parameters.options, canvas.scene),\n    };\n  });\n\n  logger.warn(formatString(deprecationFormatString, \"updateWeather\"), v2ParametersArray);\n\n  return onUpdateWeather(v2ParametersArray);\n}\n","import { roundToDecimals } from \"../../utils.js\";\n\nexport class AbstractWeatherEffect extends SpecialEffect {\n  /**\n   * The weather effect group this effect belongs to.\n   * @type {string}\n   */\n  static get group() {\n    return \"other\";\n  }\n\n  /** @type {string} */\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/snow.png\";\n  }\n\n  static get parameters() {\n    return {\n      scale: {\n        label: \"FXMASTER.Scale\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      direction: {\n        label: \"FXMASTER.Direction\",\n        type: \"range\",\n        min: 0,\n        value: (this.CONFIG.startRotation.min + this.CONFIG.startRotation.max) / 2,\n        max: 360,\n        step: 5,\n        decimals: 0,\n      },\n      speed: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      lifetime: {\n        label: \"FXMASTER.Lifetime\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      density: {\n        label: \"FXMASTER.Density\",\n        type: \"range\",\n        min: 0.1,\n        value: 0.5,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      tint: {\n        label: \"FXMASTER.Tint\",\n        type: \"color\",\n        value: {\n          value: \"#FFFFFF\",\n          apply: false,\n        },\n      },\n    };\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  /** @override */\n  static get effectOptions() {\n    const optionTypeMapping = {\n      color: SpecialEffect.OPTION_TYPES.value,\n      number: SpecialEffect.OPTION_TYPES.VALUE,\n      range: SpecialEffect.OPTION_TYPES.RANGE,\n    };\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [\n        parameterName,\n        { ...parameterConfig, type: optionTypeMapping[parameterConfig.type] },\n      ]),\n    );\n  }\n\n  applyOptionsToConfig(config) {\n    this._applyScaleToConfig(config);\n    this._applySpeedToConfig(config);\n    this._applyDirectionToConfig(config);\n    this._applyLifetimeToConfig(config);\n    this._applyTintToConfig(config);\n  }\n\n  /** @protected */\n  _applyFactorToBasicTweenableOrValueListOrRandNumber(basicTweenableOrValueListOrRandNumber, factor) {\n    if (\"start\" in basicTweenableOrValueListOrRandNumber) {\n      basicTweenableOrValueListOrRandNumber.start = basicTweenableOrValueListOrRandNumber.start * factor;\n    }\n    if (\"end\" in basicTweenableOrValueListOrRandNumber) {\n      basicTweenableOrValueListOrRandNumber.end = basicTweenableOrValueListOrRandNumber.end * factor;\n    }\n    if (\"list\" in basicTweenableOrValueListOrRandNumber) {\n      basicTweenableOrValueListOrRandNumber.list = basicTweenableOrValueListOrRandNumber.list.map((valueStep) => ({\n        ...valueStep,\n        value: valueStep.value * factor,\n      }));\n    }\n    if (\"min\" in basicTweenableOrValueListOrRandNumber) {\n      basicTweenableOrValueListOrRandNumber.min = basicTweenableOrValueListOrRandNumber.min * factor;\n    }\n    if (\"max\" in basicTweenableOrValueListOrRandNumber) {\n      basicTweenableOrValueListOrRandNumber.max = basicTweenableOrValueListOrRandNumber.max * factor;\n    }\n  }\n\n  /** @protected */\n  _applyScaleToConfig(config) {\n    const scale = config.scale ?? {};\n    const factor = (this.options.scale?.value ?? 1) * (canvas.dimensions.size / 100);\n    this._applyFactorToBasicTweenableOrValueListOrRandNumber(scale, factor);\n  }\n\n  /** @protected */\n  _applySpeedToConfig(config) {\n    const factor = (this.options.speed?.value ?? 1) * (canvas.dimensions.size / 100);\n\n    const speed = config.speed ?? {};\n    this._applyFactorToBasicTweenableOrValueListOrRandNumber(speed, factor);\n\n    const lifeTime = config.lifetime ?? {};\n    this._applyFactorToBasicTweenableOrValueListOrRandNumber(lifeTime, 1 / factor);\n\n    config.frequency /= factor;\n  }\n\n  /** @protected */\n  _applyDirectionToConfig(config) {\n    const direction = this.options.direction?.value;\n    const range = (config.startRotation?.max ?? 0) - (config.startRotation?.min ?? 0);\n    if (direction !== undefined) {\n      config.startRotation = { min: direction - range / 2, max: direction + range / 2 };\n    }\n  }\n\n  /** @protected */\n  _applyLifetimeToConfig(config) {\n    const lifetime = config.lifetime ?? {};\n    const factor = this.options.lifetime?.value ?? 1;\n    this._applyFactorToBasicTweenableOrValueListOrRandNumber(lifetime, factor);\n    config.frequency *= factor;\n  }\n\n  /** @protected */\n  _applyTintToConfig(config) {\n    if (this.options.tint?.value.apply) {\n      const value = this.options.tint.value.value;\n      config.color = {\n        list: [\n          { value, time: 0 },\n          { value, time: 1 },\n        ],\n      };\n    }\n  }\n\n  /**\n   * Fade this effect out, playing it once and then stopping it.\n   * @param {{timeout?: number}} [options]         Additional options to configure the fade out\n   * @param {number}             [options.timeout] If given, the effect will be stopped after the given number in ms,\n   *                                               regardless of if it has finished playing or not.\n   * @returns {Promise<void>}                      A promise that resolves as soon as this effect has finished fading out\n   */\n  async fadeOut({ timeout } = {}) {\n    const emitterPromises = this.emitters.map(\n      (emitter) =>\n        new Promise((resolve) => {\n          emitter.emitterLifetime = 0.1;\n          emitter.playOnceAndDestroy(() => {\n            resolve();\n          });\n        }),\n    );\n    const promises = [Promise.all(emitterPromises)];\n    if (timeout !== undefined) {\n      promises.push(new Promise((resolve) => setTimeout(resolve, timeout)));\n    }\n\n    await Promise.race(promises);\n    this.stop();\n  }\n\n  static convertOptionsToV2(options, scene) {\n    return Object.fromEntries(\n      Object.entries(options).map(([optionKey, optionValue]) => {\n        switch (optionKey) {\n          case \"scale\": {\n            return [optionKey, this._convertScaleToV2(optionValue, scene)];\n          }\n          case \"speed\": {\n            return [optionKey, this._convertSpeedToV2(optionValue, scene)];\n          }\n          case \"density\": {\n            return [optionKey, this._convertDensityToV2(optionValue, scene)];\n          }\n          default: {\n            return [optionKey, optionValue];\n          }\n        }\n      }),\n    );\n  }\n\n  /** @protected */\n  static _convertScaleToV2(scale, scene) {\n    const decimals = this.parameters.scale?.decimals ?? 1;\n    return roundToDecimals(scale * (100 / scene.dimensions.size), decimals);\n  }\n\n  /** @protected */\n  static _convertSpeedToV2(speed, scene) {\n    const speeds = this.CONFIG.speed?.list?.map((valueStep) => valueStep.value) ?? [];\n    if (\"start\" in (this.CONFIG.speed ?? {})) {\n      speeds.push(this.CONFIG.speed.start);\n    }\n    if (\"end\" in (this.CONFIG.speed ?? {})) {\n      speeds.push(this.CONFIG.speed.end);\n    }\n    const maximumSpeed = Math.max(...speeds);\n\n    const decimals = this.parameters.speed?.decimals ?? 1;\n    return roundToDecimals((speed / maximumSpeed) * (100 / scene.dimensions.size), decimals);\n  }\n\n  /** @protected */\n  static _convertDensityToV2(density, scene) {\n    const d = scene.dimensions;\n    const gridUnits = (d.width / d.size) * (d.height / d.size);\n\n    const decimals = this.parameters.density?.decimals ?? 1;\n    return roundToDecimals(density / gridUnits, decimals);\n  }\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class BubblesWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Bubbles\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/bubbles.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.01, value: 0.15, max: 0.5, step: 0.01, decimals: 2 },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getBubbleEmitter(this.parent)];\n  }\n\n  _getBubbleEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    const art = [\"modules/fxmaster/assets/weatherEffects/effects/bubbles.png\"];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Bubbles particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.85, time: 0.05 },\n          { value: 0.85, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n      },\n      scale: {\n        start: 0.25,\n        end: 0.5,\n        minimumScaleMultiplier: 0.5,\n      },\n      speed: {\n        start: 20,\n        end: 60,\n        minimumSpeedMultiplier: 0.6,\n      },\n      color: {\n        list: [\n          { value: \"ffffff\", time: 0 },\n          { value: \"ffffff\", time: 1 },\n        ],\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      rotationSpeed: {\n        min: 100,\n        max: 200,\n      },\n      lifetime: {\n        min: 8,\n        max: 10,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class CloudsWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Clouds\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/fog.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.001, value: 0.03, max: 0.2, step: 0.001, decimals: 3 },\n    });\n  }\n\n  /** @override */\n  getParticleEmitters() {\n    return [this._getCloudEmitter(this.parent)];\n  }\n\n  _getCloudEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.sceneRect.width / d.size) * (d.sceneRect.height / d.size) * this.options.density.value;\n\n    const offsetFactor = 2 / 3;\n\n    const diagonal = Math.sqrt(d.sceneRect.width * d.sceneRect.width + d.sceneRect.height * d.sceneRect.height);\n    const maximumAverageSpeed = (this.constructor.CONFIG.speed.start + this.constructor.CONFIG.speed.end) / 2;\n    const averageSpeed = (maximumAverageSpeed * (1 + this.constructor.CONFIG.speed.minimumSpeedMultiplier)) / 2;\n    const averageDiagonalTime = diagonal / averageSpeed;\n    const minLifetime = averageDiagonalTime / offsetFactor / 2;\n    const maxLifetime = averageDiagonalTime / offsetFactor;\n\n    const angle = Math.toRadians(this.options.direction.value);\n    const directionVector = {\n      x: Math.cos(angle),\n      y: Math.sin(angle),\n    };\n\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x - directionVector.x * d.sceneRect.width * offsetFactor,\n          y: d.sceneRect.y - directionVector.y * d.sceneRect.height * offsetFactor,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: (minLifetime + maxLifetime) / 2 / p,\n        lifetime: {\n          min: minLifetime,\n          max: maxLifetime,\n        },\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Animation\n    const art = [\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud1.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud2.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud3.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud4.png\",\n    ];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Clouds particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.5, time: 0.05 },\n          { value: 0.5, time: 0.95 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        start: 0.8,\n        end: 0.8,\n        minimumScaleMultiplier: 0.1,\n      },\n      speed: {\n        start: 100,\n        end: 100,\n        minimumSpeedMultiplier: 0.3,\n      },\n      color: {\n        list: [\n          { value: \"ffffff\", time: 0 },\n          { value: \"ffffff\", time: 1 },\n        ],\n      },\n      startRotation: {\n        min: 80,\n        max: 100,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class EmbersWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Embers\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/embers.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.7, max: 1.4, step: 0.05, decimals: 2 },\n      tint: { value: { value: \"#f77300\" } },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getEmbersEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getEmbersEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Assets are selected randomly from the list for each particle\n    const art = [\"modules/fxmaster/assets/weatherEffects/effects/ember.png\"];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    emitter.startColor = PIXI.particles.ParticleUtils.createSteppedGradient(config.color.list, true);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Embers particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.9, time: 0.3 },\n          { value: 0.9, time: 0.95 },\n          { value: 0, time: 1 },\n        ],\n      },\n      scale: {\n        start: 0.15,\n        end: 0.01,\n        minimumScaleMultiplier: 0.85,\n      },\n      speed: {\n        start: 40,\n        end: 40,\n        minimumSpeedMultiplier: 0.6,\n      },\n      color: {\n        list: [\n          { value: \"f77300\", time: 0 },\n          { value: \"f72100\", time: 1 },\n        ],\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      rotationSpeed: {\n        min: 100,\n        max: 200,\n      },\n      lifetime: {\n        min: 4,\n        max: 6,\n      },\n      blendMode: \"screen\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class CrowsWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Crows\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/crows.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.001, value: 0.006, max: 0.01, step: 0.001, decimals: 3 },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getCrowsEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getCrowsEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Assets are selected randomly from the list for each particle\n    const anim_sheet = {\n      framerate: \"15\",\n      textures: [\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven1.png\",\n          count: 20,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven2.png\",\n          count: 3,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven3.png\",\n          count: 2,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven4.png\",\n          count: 2,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven3.png\",\n          count: 2,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven2.png\",\n          count: 3,\n        },\n      ],\n      loop: true,\n    };\n    const emitter = new PIXI.particles.Emitter(parent, anim_sheet, config);\n    emitter.particleConstructor = PIXI.particles.AnimatedParticle;\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Crows particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 1, time: 0.02 },\n          { value: 1, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        list: [\n          { value: 0.03, time: 0 },\n          { value: 0.12, time: 0.1 },\n          { value: 0.12, time: 0.9 },\n          { value: 0.03, time: 1 },\n        ],\n        isStepped: false,\n      },\n      speed: {\n        start: 90,\n        end: 100,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      lifetime: {\n        min: 20,\n        max: 40,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class BatsWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Bats\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/bats.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.005, value: 0.05, max: 0.1, step: 0.005, decimals: 3 },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getBatsEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getBatsEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Assets are selected randomly from the list for each particle\n    const anim_sheet = {\n      framerate: \"30\",\n      textures: [\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat0.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat1.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat2.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat3.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat4.png\",\n          count: 2,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat3.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat2.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat1.png\",\n          count: 1,\n        },\n      ],\n      loop: true,\n    };\n    const emitter = new PIXI.particles.Emitter(parent, anim_sheet, config);\n    emitter.particleConstructor = PIXI.particles.AnimatedParticle;\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Bats particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 1, time: 0.02 },\n          { value: 1, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        list: [\n          { value: 0.02, time: 0 },\n          { value: 0.1, time: 0.05 },\n          { value: 0.1, time: 0.95 },\n          { value: 0.02, time: 1 },\n        ],\n        isStepped: false,\n      },\n      speed: {\n        start: 200,\n        end: 260,\n        minimumSpeedMultiplier: 0.8,\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      lifetime: {\n        min: 20,\n        max: 40,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class FogWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Fog\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/fog.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.01, value: 0.08, max: 0.15, step: 0.01, decimals: 2 },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getFogEmitter(this.parent)];\n  }\n\n  _getFogEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Animation\n    const art = [\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud1.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud2.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud3.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud4.png\",\n    ];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Fog particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.1, time: 0.1 },\n          { value: 0.3, time: 0.5 },\n          { value: 0.1, time: 0.9 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        start: 1.5,\n        end: 1.0,\n        minimumScaleMultiplier: 0.5,\n      },\n      speed: {\n        start: 15,\n        end: 10,\n        minimumSpeedMultiplier: 0.2,\n      },\n      color: {\n        list: [\n          { value: \"dddddd\", time: 0 },\n          { value: \"dddddd\", time: 1 },\n        ],\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      rotationSpeed: {\n        min: 0.15,\n        max: 0.35,\n      },\n      lifetime: {\n        min: 10,\n        max: 25,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class RaintopWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Rain Topdown\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/rain.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.01, value: 0.3, max: 1, step: 0.01, decimals: 2 },\n      \"-=direction\": null,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getEmitter(this.parent)];\n  }\n\n  _getEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const sceneRadius = Math.sqrt(d.sceneWidth * d.sceneWidth + d.sceneHeight * d.sceneHeight) / 2;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnType: \"ring\",\n        speed: {\n          start: d.width / 3,\n          end: d.height / 4,\n          minimumSpeedMultiplier: 0.8,\n        },\n        spawnCircle: {\n          x: d.sceneRect.x + d.sceneWidth / 2,\n          y: d.sceneRect.y + d.sceneHeight / 2,\n          r: sceneRadius * 1.3,\n          minR: sceneRadius / 2,\n        },\n        maxParticles: p,\n        frequency: 1 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    const art = [\"ui/particles/rain.png\"];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Rain Top particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.6, time: 0.1 },\n          { value: 0.23, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        start: 3,\n        end: 0.4,\n        minimumScaleMultiplier: 0.7,\n      },\n      color: {\n        start: \"dddddd\",\n        end: \"dddddd\",\n      },\n      startRotation: {\n        min: 180,\n        max: 180,\n      },\n      lifetime: {\n        min: 0.3,\n        max: 0.7,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class RainSimpleWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Rain Without Splash\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/rain.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  getParticleEmitters() {\n    return [this._getRainEmitter(this.parent)];\n  }\n\n  _getRainEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: -0.05 * d.width,\n          y: -0.1 * d.height,\n          w: d.width,\n          h: 0.8 * d.height,\n        },\n        maxParticles: p,\n        frequency: 1 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    return new PIXI.particles.Emitter(parent, [\"ui/particles/rain.png\"], config);\n  }\n\n  /**\n   * Configuration for the Rain Simple particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 0.7,\n        end: 0.1,\n      },\n      scale: {\n        start: 1.0,\n        end: 1.0,\n        minimumScaleMultiplier: 0.8,\n      },\n      speed: {\n        start: 3500,\n        end: 3500,\n        minimumSpeedMultiplier: 0.8,\n      },\n      startRotation: {\n        min: 75,\n        max: 75,\n      },\n      lifetime: {\n        min: 0.5,\n        max: 0.5,\n      },\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class SnowstormWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Snowstorm\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/snow.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.6, max: 1, step: 0.05, decimals: 2 },\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getSnowEmitter(this.parent)];\n  }\n\n  _getSnowEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: (this.constructor.CONFIG.lifetime.min + this.constructor.CONFIG.lifetime.max) / 2 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    const art = [\n      \"modules/fxmaster/assets/weatherEffects/effects/snow_01.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/snow_02.png\",\n    ];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    emitter.particleConstructor = PIXI.particles.PathParticle;\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Snowstorm particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 1.0,\n        end: 1.0,\n      },\n      scale: {\n        start: 0.2,\n        end: 0.08,\n        minimumScaleMultiplier: 0.8,\n      },\n      speed: {\n        start: 400,\n        end: 350,\n        minimumSpeedMultiplier: 0.2,\n      },\n      startRotation: {\n        min: 86,\n        max: 94,\n      },\n      rotationSpeed: {\n        min: -60.0,\n        max: 60.0,\n      },\n      lifetime: {\n        min: 2.5,\n        max: 6,\n      },\n      extraData: {\n        path: \"sin(x/150)*25\",\n      },\n    },\n    { inplace: false },\n  );\n}\n","import { formatString } from \"../../utils.js\";\nimport { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class BirdsWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Birds\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/crows.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.001, value: 0.006, max: 0.01, step: 0.001, decimals: 3 },\n      \"-=direction\": undefined,\n      animations: {\n        label: \"FXMASTER.Animations\",\n        type: \"multi-select\",\n        options: {\n          glide: \"FXMASTER.WeatherBirdsAnimationsGlide\",\n          flap: \"FXMASTER.WeatherBirdsAnimationsFlap\",\n          mixed: \"FXMASTER.WeatherBirdsAnimationsMixed\",\n        },\n        value: [\"mixed\"],\n      },\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    const animations = {\n      glide: [\n        { textureNumber: 2, count: 30 },\n        ...Array(4)\n          .fill([\n            { textureNumber: 1, count: 3 },\n            { textureNumber: 2, count: 2 },\n            { textureNumber: 3, count: 3 },\n            { textureNumber: 2, count: 2 },\n          ])\n          .deepFlatten(),\n        { textureNumber: 2, count: 68 },\n      ],\n      flap: [\n        { textureNumber: 1, count: 3 },\n        { textureNumber: 2, count: 2 },\n        { textureNumber: 3, count: 3 },\n        { textureNumber: 2, count: 2 },\n      ],\n      mixed: [\n        { textureNumber: 2, count: 7 },\n        { textureNumber: 1, count: 3 },\n        { textureNumber: 2, count: 2 },\n        { textureNumber: 3, count: 3 },\n        { textureNumber: 2, count: 7 },\n      ],\n    };\n\n    const getAnim = (animation, textureFormatString) => ({\n      framerate: 20,\n      loop: true,\n      textures: animation.map(({ textureNumber, count }) => ({\n        texture: formatString(textureFormatString, textureNumber),\n        count,\n      })),\n    });\n\n    const textureFormatString = \"modules/fxmaster/assets/weatherEffects/effects/seagull_{0}.png\";\n\n    // Assets are selected randomly from the list for each particle\n    const anims = (this.options.animations?.value ?? [])\n      .filter((animation) => Object.keys(animations).includes(animation))\n      .map((animation) => getAnim(animations[animation], textureFormatString));\n\n    if (anims.length === 0) {\n      anims.push(getAnim(animations.mixed, textureFormatString));\n    }\n\n    const emitter = new PIXI.particles.Emitter(parent, anims, config);\n    emitter.particleConstructor = PIXI.particles.AnimatedParticle;\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Birds particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 1, time: 0.02 },\n          { value: 1, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        list: [\n          { value: 0.3, time: 0 },\n          { value: 0.7, time: 0.1 },\n          { value: 0.7, time: 0.9 },\n          { value: 0.3, time: 1 },\n        ],\n        isStepped: false,\n      },\n      speed: {\n        start: 90,\n        end: 100,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      lifetime: {\n        min: 20,\n        max: 40,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class StarsWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Stars\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/stars.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.3, max: 1, step: 0.05, decimals: 2 },\n      tint: { value: { value: \"#bee8ee\" } },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Assets are selected randomly from the list for each particle\n    const art = [\n      \"modules/fxmaster/assets/weatherEffects/effects/star_01.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_02.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_04.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_05.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_06.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_07.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_08.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_09.png\",\n    ];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    emitter.startColor = PIXI.particles.ParticleUtils.createSteppedGradient(config.color.list, true);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Stars particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.9, time: 0.3 },\n          { value: 0.9, time: 0.95 },\n          { value: 0, time: 1 },\n        ],\n      },\n      scale: {\n        start: 0.05,\n        end: 0.03,\n        minimumScaleMultiplier: 0.85,\n      },\n      speed: {\n        start: 5,\n        end: 5,\n        minimumSpeedMultiplier: 0.6,\n      },\n      color: {\n        list: [\n          { value: \"bee8ee\", time: 0 },\n          { value: \"d0e8ec\", time: 1 },\n        ],\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      rotationSpeed: {\n        min: 20,\n        max: 50,\n      },\n      lifetime: {\n        min: 8,\n        max: 15,\n      },\n      blendMode: \"screen\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\n/**\n * A special full-screen weather effect which uses two Emitters to render drops and splashes\n * @type {SpecialEffect}\n */\nexport class RainWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Rain\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/rain.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /**\n   * Configuration for the particle emitter for rain\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 0.7,\n        end: 0.1,\n      },\n      scale: {\n        start: 1.0,\n        end: 1.0,\n        minimumScaleMultiplier: 0.8,\n      },\n      speed: {\n        start: 3500,\n        end: 3500,\n        minimumSpeedMultiplier: 0.8,\n      },\n      startRotation: {\n        min: 75,\n        max: 75,\n      },\n      lifetime: {\n        min: 0.5,\n        max: 0.5,\n      },\n    },\n    { inplace: false },\n  );\n\n  /**\n   * Configuration for the particle emitter for splashes\n   * @type {Object}\n   */\n  static SPLASH_CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 1,\n        end: 1,\n      },\n      scale: {\n        start: 0.6,\n        end: 0.6,\n        minimumScaleMultiplier: 0.8,\n      },\n      speed: {\n        start: 0,\n        end: 0,\n      },\n      startRotation: {\n        min: -90,\n        max: -90,\n      },\n      noRotation: true,\n      lifetime: {\n        min: 0.5,\n        max: 0.5,\n      },\n    },\n    { inplace: false },\n  );\n\n  /** @override */\n  getParticleEmitters() {\n    return [this._getRainEmitter(this.parent), this._getSplashEmitter(this.parent)];\n  }\n\n  _getRainEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: -0.05 * d.width,\n          y: -0.1 * d.height,\n          w: d.width,\n          h: 0.8 * d.height,\n        },\n        maxParticles: p,\n        frequency: 1 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    return new PIXI.particles.Emitter(parent, [\"ui/particles/rain.png\"], config);\n  }\n\n  _getSplashEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.SPLASH_CONFIG,\n      {\n        spawnRect: {\n          x: 0,\n          y: 0.25 * d.height,\n          w: d.width,\n          h: 0.75 * d.height,\n        },\n        maxParticles: 0.5 * p,\n        frequency: 2 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    return new PIXI.particles.Emitter(parent, [\"ui/particles/drop.png\"], config);\n  }\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\n/**\n * A special full-screen weather effect which uses one Emitters to render snowflakes\n * @type {SpecialEffect}\n */\nexport class SnowWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Snow\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/snow.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /**\n   * Configuration of the particle emitter for snowflakes\n   * @type {object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 0.9,\n        end: 0.5,\n      },\n      scale: {\n        start: 0.2,\n        end: 0.4,\n        minimumScaleMultiplier: 0.5,\n      },\n      speed: {\n        start: 190,\n        end: 210,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 50,\n        max: 75,\n      },\n      rotationSpeed: {\n        min: 0,\n        max: 200,\n      },\n      lifetime: {\n        min: 4,\n        max: 4,\n      },\n    },\n    { inplace: false },\n  );\n\n  getParticleEmitters() {\n    return [this._getSnowEmitter(this.parent)];\n  }\n\n  _getSnowEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: 0,\n          y: -0.1 * d.height,\n          w: d.width,\n          h: d.height,\n        },\n        maxParticles: p,\n        frequency: (this.constructor.CONFIG.lifetime.min + this.constructor.CONFIG.lifetime.max) / 2 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    return new PIXI.particles.Emitter(parent, [\"ui/particles/snow.png\"], config);\n  }\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\n/**\n * A special full-screen weather effect which uses one Emitters to render gently falling autumn leaves\n * @extends {SpecialEffect}\n */\nexport class AutumnLeavesWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Autumn Leaves\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/leaves.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.25, max: 1, step: 0.05, decimals: 2 },\n      \"-=direction\": null,\n    });\n  }\n\n  /**\n   * Configuration for the falling leaves particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 0.9,\n        end: 0.5,\n      },\n      scale: {\n        start: 0.2,\n        end: 0.4,\n        minimumScaleMultiplier: 0.5,\n      },\n      speed: {\n        start: 20,\n        end: 60,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 0,\n        max: 365,\n      },\n      rotation: 180,\n      rotationSpeed: {\n        min: 100,\n        max: 200,\n      },\n      lifetime: {\n        min: 10,\n        max: 10,\n      },\n    },\n    { inplace: false },\n  );\n\n  getParticleEmitters() {\n    return [this._getLeafEmitter(this.parent)];\n  }\n\n  _getLeafEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    const sprites = Array.fromRange(6).map((n) => `ui/particles/leaf${n + 1}.png`);\n    return new PIXI.particles.Emitter(parent, sprites, config);\n  }\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class SpiderWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Spider\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/spiders.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.3, max: 0.7, step: 0.05, decimals: 2 },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getSpidersEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getSpidersEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Assets are selected randomly from the list for each particle\n    const anim_sheet = {\n      framerate: \"24\",\n      textures: [],\n      loop: true,\n    };\n    for (let i = 0; i < 25; i++) {\n      anim_sheet.textures.push({\n        count: 1,\n        texture: `modules/fxmaster/assets/weatherEffects/effects/Spider.${String(i).padStart(4, \"0\")}.png`,\n      });\n    }\n    const emitter = new PIXI.particles.Emitter(parent, anim_sheet, config);\n    emitter.particleConstructor = PIXI.particles.AnimatedParticle;\n\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Spider particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 1, time: 0.02 },\n          { value: 1, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n      },\n      scale: {\n        list: [\n          { value: 0.05, time: 0 },\n          { value: 0.08, time: 0.05 },\n          { value: 0.08, time: 0.95 },\n          { value: 0.05, time: 1 },\n        ],\n        minimumScaleMultiplier: 0.2,\n      },\n      speed: {\n        start: 15,\n        end: 25,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      lifetime: {\n        min: 5,\n        max: 10,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class EaglesWeatherEffect extends AbstractWeatherEffect {\n  /**\n   * The cached textures for this weather effect.\n   * @type {PIXI.Texture[] | undefined}\n   * @private\n   */\n  static _textureCache = undefined;\n\n  static get label() {\n    return \"Eagles\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/crows.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.001, value: 0.006, max: 0.01, step: 0.001, decimals: 3 },\n      \"-=direction\": undefined,\n      animations: {\n        label: \"FXMASTER.Animations\",\n        type: \"multi-select\",\n        options: {\n          flap: \"FXMASTER.WeatherBirdsAnimationsFlap\",\n          glide: \"FXMASTER.WeatherBirdsAnimationsGlide\",\n        },\n        value: [\"glide\"],\n      },\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    if (!this._textures) {\n      this._initializeTextures();\n    }\n\n    const flap = Array.fromRange(19).map((textureNumber) => ({\n      textureNumber,\n      count: 1,\n    }));\n\n    const glide = [\n      { textureNumber: 0, count: 30 },\n      ...Array(4).fill(flap).deepFlatten(),\n      { textureNumber: 0, count: 68 },\n    ];\n\n    const animations = {\n      glide,\n      flap,\n    };\n\n    const getAnim = (animation) => ({\n      framerate: 20,\n      loop: true,\n      textures: animation.map(({ textureNumber, count }) => ({\n        texture: this._textures[textureNumber],\n        count,\n      })),\n    });\n\n    // Assets are selected randomly from the list for each particle\n    const anims = (this.options.animations?.value ?? [])\n      .filter((animation) => Object.keys(animations).includes(animation))\n      .map((animation) => getAnim(animations[animation]));\n\n    if (anims.length === 0) {\n      anims.push(getAnim(animations.glide));\n    }\n\n    const emitter = new PIXI.particles.Emitter(parent, anims, config);\n    emitter.particleConstructor = PIXI.particles.AnimatedParticle;\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Eagles particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 1, time: 0.02 },\n          { value: 1, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        list: [\n          { value: 0.15, time: 0 },\n          { value: 0.3, time: 0.1 },\n          { value: 0.3, time: 0.9 },\n          { value: 0.15, time: 1 },\n        ],\n        isStepped: false,\n      },\n      speed: {\n        start: 360,\n        end: 400,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      lifetime: {\n        min: 7,\n        max: 14,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n\n  /**\n   * Get the textures for this weather effect.\n   * @private\n   * @returns {PIXI.Texture[]}\n   */\n  get _textures() {\n    if (!this.constructor._textureCache) {\n      const spriteSheetTexture = PIXI.Texture.from(\"modules/fxmaster/assets/weatherEffects/effects/eagle.png\");\n      const spriteSheetData = {\n        meta: {\n          scale: \"1\",\n        },\n        frames: {\n          \"eagle0000.png\": {\n            frame: { x: 0, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0001.png\": {\n            frame: { x: 512, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0002.png\": {\n            frame: { x: 0, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0003.png\": {\n            frame: { x: 512, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0004.png\": {\n            frame: { x: 1024, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0005.png\": {\n            frame: { x: 1024, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0006.png\": {\n            frame: { x: 0, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0007.png\": {\n            frame: { x: 512, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0008.png\": {\n            frame: { x: 1024, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0009.png\": {\n            frame: { x: 1536, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0010.png\": {\n            frame: { x: 1536, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0011.png\": {\n            frame: { x: 1536, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0012.png\": {\n            frame: { x: 0, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0013.png\": {\n            frame: { x: 512, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0014.png\": {\n            frame: { x: 1024, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0015.png\": {\n            frame: { x: 1536, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0016.png\": {\n            frame: { x: 2048, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0017.png\": {\n            frame: { x: 2048, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0018.png\": {\n            frame: { x: 2048, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0019.png\": {\n            frame: { x: 2048, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n        },\n      };\n      const spriteSheet = new PIXI.Spritesheet(spriteSheetTexture, spriteSheetData);\n      spriteSheet.parse((textures) => {\n        this.constructor._textureCache = Object.values(textures);\n      }); // This is known to complete synchronously because there are only 20 textures and PIXI only starts batching when there are more than 1000.\n    }\n    return this.constructor._textureCache;\n  }\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class RatsWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Rats\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/rats.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.001, value: 0.006, max: 0.1, step: 0.001, decimals: 3 },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getEmitter(this.parent)];\n  }\n\n  _getEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    const anim_sheet = {\n      framerate: \"10\",\n      textures: Array.fromRange(5).map(\n        (index) => `modules/fxmaster/assets/weatherEffects/effects/rat/rat_${index}.png`,\n      ),\n      loop: true,\n    };\n    const emitter = new PIXI.particles.Emitter(parent, anim_sheet, config);\n    emitter.particleConstructor = PIXI.particles.AnimatedParticle;\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Rats particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 1, time: 0.02 },\n          { value: 1, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        list: [\n          { value: 0.03, time: 0 },\n          { value: 0.125, time: 0.1 },\n          { value: 0.125, time: 0.9 },\n          { value: 0.03, time: 1 },\n        ],\n        isStepped: false,\n        minimumScaleMultiplier: 0.5,\n      },\n      speed: {\n        start: 200,\n        end: 200,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      lifetime: {\n        min: 20,\n        max: 40,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { BubblesWeatherEffect } from \"./effects/BubblesWeatherEffect.js\";\nimport { CloudsWeatherEffect } from \"./effects/CloudsWeatherEffect.js\";\nimport { EmbersWeatherEffect } from \"./effects/EmbersWeatherEffect.js\";\nimport { CrowsWeatherEffect } from \"./effects/CrowsWeatherEffect.js\";\nimport { BatsWeatherEffect } from \"./effects/BatsWeatherEffect.js\";\nimport { FogWeatherEffect } from \"./effects/FogWeatherEffect.js\";\nimport { RaintopWeatherEffect } from \"./effects/RaintopWeatherEffect.js\";\nimport { RainSimpleWeatherEffect } from \"./effects/RainSimpleWeatherEffect.js\";\nimport { SnowstormWeatherEffect } from \"./effects/SnowstormWeatherEffect.js\";\nimport { BirdsWeatherEffect } from \"./effects/BirdsWeatherEffect.js\";\nimport { StarsWeatherEffect } from \"./effects/StarsWeatherEffect.js\";\nimport { RainWeatherEffect } from \"./effects/RainWeatherEffect.js\";\nimport { SnowWeatherEffect } from \"./effects/SnowWeatherEffect.js\";\nimport { AutumnLeavesWeatherEffect } from \"./effects/AutumnLeavesWeatherEffect.js\";\nimport { SpiderWeatherEffect } from \"./effects/SpiderWeatherEffect.js\";\nimport { EaglesWeatherEffect } from \"./effects/EaglesWeatherEffect.js\";\nimport { RatsWeatherEffect } from \"./effects/RatsWeatherEffect.js\";\n\n/** @typedef {Record<string, typeof import(\"./effects/AbstractWeatherEffect.js\").AbstractWeatherEffect>} WeatherDB */\n\nexport const weatherDB = {\n  bats: BatsWeatherEffect,\n  birds: BirdsWeatherEffect,\n  crows: CrowsWeatherEffect,\n  eagles: EaglesWeatherEffect,\n  rats: RatsWeatherEffect,\n  spiders: SpiderWeatherEffect,\n\n  bubbles: BubblesWeatherEffect,\n  embers: EmbersWeatherEffect,\n  stars: StarsWeatherEffect,\n\n  leaves: AutumnLeavesWeatherEffect,\n  clouds: CloudsWeatherEffect,\n  fog: FogWeatherEffect,\n  rain: RainWeatherEffect,\n  raintop: RaintopWeatherEffect,\n  rainsimple: RainSimpleWeatherEffect,\n  snow: SnowWeatherEffect,\n  snowstorm: SnowstormWeatherEffect,\n};\n","import { packageId } from \"../../constants.js\";\n\nexport class FXColorFilter extends PIXI.filters.AdjustmentFilter {\n  constructor(options, id) {\n    super();\n    this.id = id;\n\n    this.enabled = false;\n    this.skipFading = false;\n    this.configure(options);\n  }\n\n  static get label() {\n    return \"Color\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-palette\";\n  }\n\n  static get parameters() {\n    return {\n      color: {\n        label: \"FXMASTER.Tint\",\n        type: \"color\",\n        value: {\n          value: \"#FFFFFF\",\n          apply: false,\n        },\n      },\n      saturation: {\n        label: \"FXMASTER.Saturation\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      contrast: {\n        label: \"FXMASTER.Contrast\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      brightness: {\n        label: \"FXMASTER.Brightness\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      gamma: {\n        label: \"FXMASTER.Gamma\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      red: 1,\n      green: 1,\n      blue: 1,\n      saturation: 1,\n      gamma: 1,\n      brightness: 1,\n      contrast: 1,\n    };\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  configure(opts) {\n    if (opts.color.apply) {\n      const colors = foundry.utils.hexToRGB(colorStringToHex(opts.color.value));\n      opts.red = colors[0];\n      opts.green = colors[1];\n      opts.blue = colors[2];\n    } else {\n      opts.red = opts.green = opts.blue = 1;\n    }\n    this.options = { ...this.constructor.default, ...opts };\n  }\n\n  applyOptions(opts = this.options) {\n    if (!opts) return;\n    const keys = Object.keys(opts);\n    for (const key of keys) {\n      this[key] = opts[key];\n    }\n  }\n\n  animateOptions(values = this.options) {\n    const data = {\n      name: `${packageId}.${this.constructor.name}.${this.id}`,\n      duration: 4000,\n    };\n    const anim = Object.keys(values).reduce((arr, key) => {\n      arr.push({\n        parent: this,\n        attribute: key,\n        to: values[key],\n      });\n      return arr;\n    }, []);\n    return CanvasAnimation.animateLinear(anim, data);\n  }\n\n  step() {}\n\n  play() {\n    this.enabled = true;\n    if (this.skipFading) {\n      this.skipFading = false;\n      this.applyOptions();\n      return;\n    }\n    return this.animateOptions();\n  }\n\n  // So we can destroy object afterwards\n  stop() {\n    return new Promise((resolve) => {\n      if (this.skipFading) {\n        this.skipFading = false;\n        this.enabled = false;\n        this.applyOptions(this.constructor.zeros);\n        resolve();\n        return;\n      }\n      this.animateOptions(this.constructor.zeros).finally(() => {\n        this.enabled = false;\n        resolve();\n      });\n    });\n  }\n}\n","export class FXUnderwaterFilter extends PIXI.filters.DisplacementFilter {\n  constructor(options, id) {\n    let dizzyMap = new PIXI.Sprite.from(\"modules/fxmaster/assets/filterEffects/clouds.png\");\n    super(dizzyMap);\n    this.id = id;\n\n    this.dizzyMap = dizzyMap;\n\n    this.speedConfig = {};\n    this.configure(options);\n\n    this.dizzyMap.texture.baseTexture.wrapMode = PIXI.WRAP_MODES.REPEAT;\n    this.dizzyMap.anchor.set(0.5);\n    this.dizzyMap.x = canvas.scene.data.width / 2;\n    this.dizzyMap.y = canvas.scene.data.height / 2;\n    this.dizzyMap.scale.x = 4;\n    this.dizzyMap.scale.y = 4;\n\n    this.enabled = false;\n  }\n\n  static get label() {\n    return \"Underwater\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-water\";\n  }\n\n  static get parameters() {\n    return {\n      speed: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        max: 5.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.3,\n      },\n      scale: {\n        label: \"FXMASTER.Scale\",\n        type: \"number\",\n        value: 4.0,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      speed: 0,\n      scale: 1.0,\n    };\n  }\n\n  step() {\n    this.maskSprite.x += this.speedConfig.speed;\n  }\n\n  play() {\n    canvas.background.addChild(this.dizzyMap);\n    this.enabled = true;\n    this.dizzyMap.scale.x = this.speedConfig.scale;\n    this.dizzyMap.scale.y = this.speedConfig.scale;\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  configure(opts) {\n    this.speedConfig = { ...this.constructor.defaults, ...opts };\n  }\n\n  applyOptions() {\n    if (!this.options) return;\n    const keys = Object.keys(this.options);\n    for (const key of keys) {\n      this[key] = this.options[key];\n    }\n  }\n\n  // So we can destroy object afterwards\n  stop() {\n    return new Promise((resolve) => {\n      canvas.background.removeChild(this.dizzyMap);\n      this.enabled = false;\n      resolve();\n    });\n  }\n}\n","export class FXCanvasAnimation extends CanvasAnimation {\n  static async animateSmooth(attributes, { context, name = null, duration = 1000, ontick, ease } = {}) {\n    // Prepare attributes\n    attributes = attributes\n      .map((a) => {\n        a.delta = a.to - a.parent[a.attribute];\n        a.done = 0;\n        a.remaining = duration;\n        return a;\n      })\n      .filter((a) => a.delta !== 0);\n\n    // Register the request function and context\n    context = context ?? canvas.stage;\n\n    // Dispatch the animation request and return as a Promise\n    return this._animatePromise(this._animateFrameSmooth(ease), context, name, attributes, duration, ontick);\n  }\n\n  static _animateFrameSmooth(ease) {\n    return function (deltaTime, resolve, reject, attributes, duration, ontick) {\n      let complete = attributes.length === 0;\n      let dt = (duration * PIXI.settings.TARGET_FPMS) / deltaTime;\n\n      // Update each attribute\n      try {\n        for (let a of attributes) {\n          let da = a.delta / dt;\n          a.d = da;\n          if (a.remaining < Math.abs(da) * 1.25) {\n            a.parent[a.attribute] = a.to;\n            a.done = a.delta;\n            a.remaining = 0;\n            complete = true;\n          } else {\n            let progress = a.done / a.delta;\n            let start = a.to - a.delta;\n            a.done += da;\n            a.remaining = Math.abs(a.delta) - Math.abs(a.done);\n            a.parent[a.attribute] = ease(progress) * a.delta + start;\n          }\n        }\n        if (ontick) ontick(dt, attributes);\n      } catch (err) {\n        reject(err);\n      }\n\n      // Resolve the original promise once the animation is complete\n      if (complete) resolve();\n    };\n  }\n}\n","export const easeFunctions = {\n  Linear: easeLinear,\n  InSine: easeInSine,\n  OutSine: easeOutSine,\n  InOutSine: easeInOutSine,\n  InBack: easeInBack,\n  OutBack: easeOutBack,\n  InOutBack: easeInOutBack,\n  InCubic: easeInCubic,\n  OutCubic: easeOutCubic,\n  InOutCubic: easeInOutCubic,\n  InCirc: easeInCirc,\n  OutCirc: easeOutCirc,\n  InOutCirc: easeInOutCirc,\n};\n\nexport function easeLinear(x) {\n  return x;\n}\n\nexport function easeInSine(x) {\n  return 1 - Math.cos((x * Math.PI) / 2);\n}\n\nexport function easeOutSine(x) {\n  return Math.sin((x * Math.PI) / 2);\n}\n\nexport function easeInOutSine(x) {\n  return -(Math.cos(Math.PI * x) - 1) / 2;\n}\n\nexport function easeInBack(x) {\n  const c1 = 1.70158;\n  const c3 = c1 + 1;\n  return c3 * x * x * x - c1 * x * x;\n}\n\nexport function easeOutBack(x) {\n  const c1 = 1.70158;\n  const c3 = c1 + 1;\n  return 1 + c3 * Math.pow(x - 1, 3) + c1 * Math.pow(x - 1, 2);\n}\n\nexport function easeInOutBack(x) {\n  const c1 = 1.70158;\n  const c2 = c1 * 1.525;\n  return x < 0.5\n    ? (Math.pow(2 * x, 2) * ((c2 + 1) * 2 * x - c2)) / 2\n    : (Math.pow(2 * x - 2, 2) * ((c2 + 1) * (x * 2 - 2) + c2) + 2) / 2;\n}\n\nexport function easeInCubic(x) {\n  return x * x * x;\n}\n\nexport function easeOutCubic(x) {\n  return 1 - Math.pow(1 - x, 3);\n}\n\nexport function easeInOutCubic(x) {\n  return x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2;\n}\n\nexport function easeInCirc(x) {\n  return 1 - Math.sqrt(1 - Math.pow(x, 2));\n}\n\nexport function easeOutCirc(x) {\n  return Math.sqrt(1 - Math.pow(x - 1, 2));\n}\n\nexport function easeInOutCirc(x) {\n  return x < 0.5 ? (1 - Math.sqrt(1 - Math.pow(2 * x, 2))) / 2 : (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\n}\n","import { FXCanvasAnimation } from \"../../canvasanimation.js\";\nimport { packageId } from \"../../constants.js\";\nimport { easeFunctions } from \"../../ease.js\";\n\nexport class FXLightningFilter extends PIXI.filters.AdjustmentFilter {\n  constructor(options, id) {\n    super();\n    this.id = id;\n\n    this.enabled = false;\n    this.configure(options);\n\n    this.next = canvas.app.ticker.lastTime / 10;\n  }\n\n  static get label() {\n    return \"Lightning\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-bolt\";\n  }\n\n  static get parameters() {\n    return {\n      frequency: {\n        label: \"FXMASTER.Period\",\n        type: \"range\",\n        max: 2000,\n        min: 100,\n        step: 5,\n        value: 500,\n      },\n      spark_duration: {\n        label: \"FXMASTER.Duration\",\n        type: \"range\",\n        max: 2000,\n        min: 100,\n        step: 5,\n        value: 300,\n      },\n      brightness: {\n        label: \"FXMASTER.Brightness\",\n        type: \"range\",\n        max: 4.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.3,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      frequency: 0.0,\n      spark_duration: 0.0,\n      brightness: 1.0,\n    };\n  }\n\n  play() {\n    this.enabled = true;\n  }\n\n  step() {\n    if (canvas.app.ticker.lastTime / 10 > this.next) {\n      this.next = canvas.app.ticker.lastTime / 10 + 40 + this.options.frequency * Math.random();\n\n      const animate = (target) => {\n        const attributes = [\n          {\n            parent: this,\n            attribute: \"brightness\",\n            to: target,\n          },\n        ];\n        return FXCanvasAnimation.animateSmooth(attributes, {\n          name: `${packageId}.${this.constructor.name}.${this.id}.${randomID()}`,\n          context: this,\n          duration: 100 + this.options.spark_duration * Math.random(),\n          ease: easeFunctions.InOutBack,\n        });\n      };\n\n      animate(this.options.brightness).then(() => {\n        animate(1.0);\n      });\n    }\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n  configure(opts) {\n    const merged = { ...this.constructor.default, ...opts };\n    this.options = merged;\n  }\n\n  applyOptions(opts = this.options) {\n    if (!opts) return;\n    const keys = Object.keys(opts);\n    for (const key of keys) {\n      this[key] = opts[key];\n    }\n  }\n\n  // So we can destroy object afterwards\n  stop() {\n    return new Promise((resolve) => {\n      this.enabled = false;\n      resolve();\n    });\n  }\n}\n","export class FXPredatorFilter extends PIXI.filters.CRTFilter {\n  constructor(options, id) {\n    super();\n    this.id = id;\n\n    this.enabled = false;\n    this.vignetting = 0;\n    this.curvature = 0;\n\n    this.configure(options);\n  }\n\n  static get label() {\n    return \"Predator\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-wave-square\";\n  }\n\n  static get parameters() {\n    return {\n      noise: {\n        label: \"FXMASTER.Noise\",\n        type: \"range\",\n        max: 1.0,\n        min: 0,\n        step: 0.1,\n        value: 0.1,\n      },\n      period: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        max: 0.1,\n        min: 0,\n        step: 0.001,\n        value: 0.001,\n      },\n      lineWidth: {\n        label: \"FXMASTER.LineWidth\",\n        type: \"range\",\n        max: 10,\n        min: 0,\n        step: 0.1,\n        value: 1,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      noise: 0,\n      period: 1000,\n    };\n  }\n\n  play() {\n    this.enabled = true;\n    this.seed = Math.random();\n    this.applyOptions();\n  }\n\n  step() {\n    this.seed = Math.random();\n    const frequency = 1.0 / this.options.period;\n    this.time = canvas.app.ticker.lastTime / frequency;\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  configure(opts) {\n    this.options = { ...this.constructor.default, ...opts };\n  }\n\n  applyOptions() {\n    if (!this.options) return;\n    const keys = Object.keys(this.options);\n    for (const key of keys) {\n      this[key] = this.options[key];\n    }\n  }\n\n  // So we can destroy object afterwards\n  stop() {\n    return new Promise((resolve) => {\n      this.enabled = false;\n      this.applyOptions(this.constructor.zeros);\n      resolve();\n    });\n  }\n}\n","export class FXOldFilmFilter extends PIXI.filters.OldFilmFilter {\n  constructor(options, id) {\n    super();\n    this.id = id;\n\n    this.enabled = false;\n    this.skipFading = false;\n\n    this.vignetting = 0;\n    this.vignettingAlpha = 0;\n\n    this.configure(options);\n  }\n\n  static get label() {\n    return \"Old Film\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-film\";\n  }\n\n  static get parameters() {\n    return {\n      sepia: {\n        label: \"FXMASTER.Sepia\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.3,\n      },\n      noise: {\n        label: \"FXMASTER.Noise\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.1,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      sepia: 0.0,\n      noise: 0.0,\n    };\n  }\n\n  play() {\n    this.enabled = true;\n    this.seed = Math.random();\n    this.applyOptions();\n  }\n\n  step() {\n    this.seed = Math.random();\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  configure(opts) {\n    this.options = { ...this.constructor.default, ...opts };\n  }\n\n  applyOptions() {\n    if (!this.options) return;\n    const keys = Object.keys(this.options);\n    for (const key of keys) {\n      this[key] = this.options[key];\n    }\n  }\n\n  // So we can destroy object afterwards\n  stop() {\n    return new Promise((resolve) => {\n      this.enabled = false;\n      this.applyOptions(this.constructor.zeros);\n      resolve();\n    });\n  }\n}\n","import { packageId } from \"../../constants.js\";\n\nexport class FXBloomFilter extends PIXI.filters.AdvancedBloomFilter {\n  constructor(options, id) {\n    super();\n    this.id = id;\n\n    this.enabled = false;\n    this.skipFading = false;\n    this.configure(options);\n  }\n\n  static get label() {\n    return \"Bloom\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-ghost\";\n  }\n\n  static get parameters() {\n    return {\n      blur: {\n        label: \"FXMASTER.Blur\",\n        type: \"range\",\n        max: 10.0,\n        min: 0.0,\n        step: 1.0,\n        value: 1.0,\n      },\n      bloomScale: {\n        label: \"FXMASTER.Bloom\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.1,\n      },\n      threshold: {\n        label: \"FXMASTER.Threshold\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.5,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      noise: 0.0,\n      bloomScale: 0.0,\n      threshold: 1.0,\n    };\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  play() {\n    this.enabled = true;\n    if (this.skipFading) {\n      this.skipFading = false;\n      this.applyOptions();\n      return;\n    }\n    return this.animateOptions();\n  }\n\n  step() {}\n\n  configure(opts) {\n    this.options = { ...this.constructor.default, ...opts };\n  }\n\n  applyOptions(opts = this.options) {\n    if (!opts) return;\n    const keys = Object.keys(opts);\n    for (const key of keys) {\n      this[key] = opts[key];\n    }\n  }\n\n  animateOptions(values = this.options) {\n    const data = {\n      name: `${packageId}.${this.constructor.name}.${this.id}`,\n      duration: 4000,\n    };\n    const anim = Object.keys(values).reduce((arr, key) => {\n      arr.push({\n        parent: this,\n        attribute: key,\n        to: values[key],\n      });\n      return arr;\n    }, []);\n    return CanvasAnimation.animateLinear(anim, data);\n  }\n\n  // So we can destroy object afterwards\n  async stop() {\n    await CanvasAnimation.terminateAnimation(`${packageId}.${this.constructor.name}.${this.id}`);\n    if (this.skipFading) {\n      this.skipFading = false;\n      this.enabled = false;\n      this.applyOptions(this.constructor.zeros);\n      return;\n    }\n    this.animateOptions(this.constructor.zeros).finally(() => {\n      this.enabled = false;\n    });\n  }\n}\n","import { FXColorFilter } from \"./filters/FXColorFilter.js\";\nimport { FXUnderwaterFilter } from \"./filters/FXUnderwaterFilter.js\";\nimport { FXLightningFilter } from \"./filters/FXLightningFilter.js\";\nimport { FXPredatorFilter } from \"./filters/FXPredatorFilter.js\";\nimport { FXOldFilmFilter } from \"./filters/FXOldFilmFilter.js\";\nimport { FXBloomFilter } from \"./filters/FXBloomFilter.js\";\n// import {FXFogFilter} from \"./filters/FXFogFilter.js\"\n\nexport const filtersDB = {\n  bloom: FXBloomFilter,\n  color: FXColorFilter,\n  // fog: FXFogFilter\n  lightning: FXLightningFilter,\n  oldfilm: FXOldFilmFilter,\n  predator: FXPredatorFilter,\n  underwater: FXUnderwaterFilter,\n};\n","import { weatherDB } from \"./weatherEffects/weatherDB.js\";\nimport { filtersDB } from \"./filterEffects/filtersDB.js\";\nimport { specialsDB } from \"./specialEffects/specialsDB.js\";\n\nexport const FXMASTER = {\n  weatherEffects: weatherDB,\n  filters: filtersDB,\n  specials: specialsDB,\n};\n","export const specialsDB = {\n  fxmaster: {\n    label: \"FXMaster\",\n    effects: [\n      {\n        label: \"Smoke Bomb\",\n        file: \"modules/fxmaster/assets/specialEffects/fxmaster/smokeBomb.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        speed: 0,\n        author: \"U~man\",\n      },\n      {\n        label: \"Fireball\",\n        file: \"modules/fxmaster/assets/specialEffects/fxmaster/fireball.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        author: \"U~man\",\n      },\n      {\n        label: \"Blood Splatter\",\n        file: \"modules/fxmaster/assets/specialEffects/fxmaster/blood.webm\",\n        scale: {\n          x: 0.7,\n          y: 0.7,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        author: \"U~man\",\n      },\n      {\n        label: \"Red Fire Cone\",\n        file: \"modules/fxmaster/assets/specialEffects/jinker/dragonBornGold-RedFire15Cone.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"Jinker\",\n      },\n      {\n        label: \"Acid Line\",\n        file: \"modules/fxmaster/assets/specialEffects/jinker/dragonBornBlack-CopperAcid30x5Line.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"Jinker\",\n      },\n      {\n        label: \"Witch Bolt\",\n        file: \"modules/fxmaster/assets/specialEffects/jb2a/Witch_Bolt_Blue_600x200.webm\",\n        scale: {\n          x: 0.7,\n          y: 0.7,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"JB2A\",\n      },\n    ],\n  },\n};\n","import { packageId } from \"../constants.js\";\nimport { logger } from \"../logger.js\";\nimport { executeWhenWorldIsMigratedToLatest, isOnTargetMigration } from \"../migration.js\";\nimport { intersectRectangles } from \"../pixi-helpers.js\";\n\n// holes are broken in @pixi/smooth-graphics@0.0.17 (see https://github.com/pixijs/graphics-smooth/pull/7), so we need to use the legacy graphics in V9 and above.\nconst Graphics = PIXI.LegacyGraphics ?? PIXI.Graphics;\n\nexport class WeatherLayer extends CanvasLayer {\n  /**\n   * The weather overlay container\n   * @type {PIXI.Container | undefined}\n   */\n  weather = undefined;\n\n  /**\n   * The currently active weather effects.\n   * @type {Record<string, {type: string, fx: import('./effects/AbstractWeatherEffect.js').AbstractWeatherEffect}>}\n   */\n  weatherEffects = {};\n\n  /**\n   * The scene mask.\n   * @type {CachedContainer | undefined}\n   * @private\n   */\n  _sceneMask = undefined;\n\n  /**\n   * The filter used to apply the scene mask.\n   * @type {InverseOcclusionMaskFilter | undefined}\n   * @private\n   */\n  _sceneMaskFilter = undefined;\n\n  static get layerOptions() {\n    return foundry.utils.mergeObject(super.layerOptions, {\n      name: \"weather\",\n      zIndex: 250,\n    });\n  }\n\n  /**\n   * Whether or not the weather effects should be masked to the scene.\n   * @type {boolean}\n   */\n  get shouldMaskToScene() {\n    return !!canvas.scene?.img;\n  }\n\n  _createInvertedMask() {\n    const mask = new Graphics();\n    canvas.drawings.placeables.forEach((drawing) => {\n      const isMask = drawing.document.getFlag(packageId, \"masking\");\n      if (!isMask) return;\n      mask.beginFill(0x000000);\n      const shape = drawing.shape.geometry.graphicsData[0].shape.clone();\n      switch (drawing.data.type) {\n        case CONST.DRAWING_TYPES.ELLIPSE: {\n          shape.x = drawing.center.x;\n          shape.y = drawing.center.y;\n          mask.drawShape(shape);\n          break;\n        }\n        case CONST.DRAWING_TYPES.POLYGON:\n        case CONST.DRAWING_TYPES.FREEHAND: {\n          const points = drawing.data.points.reduce((acc, v) => {\n            acc.push(v[0] + drawing.x, v[1] + drawing.y);\n            return acc;\n          }, []);\n          mask.drawPolygon(points);\n          break;\n        }\n        default: {\n          shape.x = drawing.x;\n          shape.y = drawing.y;\n          mask.drawShape(shape);\n        }\n      }\n      mask.endFill();\n    });\n    return mask;\n  }\n\n  _createMask() {\n    const mask = new Graphics();\n    mask.beginFill(0x000000).drawShape(canvas.dimensions.rect).endFill();\n\n    canvas.drawings.placeables.forEach((drawing) => {\n      const isMask = drawing.document.getFlag(packageId, \"masking\");\n      if (!isMask) return;\n      mask.beginHole();\n      const shape = drawing.shape.geometry.graphicsData[0].shape.clone();\n      switch (drawing.data.type) {\n        case CONST.DRAWING_TYPES.ELLIPSE: {\n          shape.x = drawing.center.x;\n          shape.y = drawing.center.y;\n          mask.drawShape(shape);\n          break;\n        }\n        case CONST.DRAWING_TYPES.POLYGON:\n        case CONST.DRAWING_TYPES.FREEHAND: {\n          const points = drawing.data.points.reduce((acc, v) => {\n            acc.push(v[0] + drawing.x, v[1] + drawing.y);\n            return acc;\n          }, []);\n          mask.drawPolygon(points);\n          break;\n        }\n        default: {\n          shape.x = drawing.x;\n          shape.y = drawing.y;\n          mask.drawShape(shape);\n        }\n      }\n      mask.endHole();\n    });\n    return mask;\n  }\n\n  updateMask() {\n    if (!this.weather || !canvas.scene) return;\n\n    if (this.weather.mask) {\n      this.weather.removeChild(this.weather.mask);\n      this.weather.mask.destroy();\n      this.weather.mask = null;\n    }\n    const invert = canvas.scene.getFlag(packageId, \"invert\");\n\n    // Mask zones masked by drawings\n    const mask = invert ? this._createInvertedMask() : this._createMask();\n    this.weather.addChild(mask);\n\n    Hooks.callAll(\"updateMask\", this, this.weather, mask);\n    this.weather.mask = mask;\n  }\n\n  /** @override */\n  async tearDown() {\n    Object.values(this.weatherEffects).forEach(({ fx }) => fx.stop());\n\n    this.weather = undefined;\n    this.mask = null;\n    this.weatherEffects = {};\n    this._sceneMask?.destroy();\n    this._sceneMask = undefined;\n    this._sceneMaskFilter = undefined;\n\n    return super.tearDown();\n  }\n\n  /** @override */\n  async draw() {\n    if (!game.settings.get(packageId, \"enable\") || game.settings.get(packageId, \"disableAll\")) {\n      return;\n    }\n    if (isOnTargetMigration()) {\n      await this._draw();\n    } else {\n      // If migrations need to be performed, defer drawing to when they are done.\n      executeWhenWorldIsMigratedToLatest(this._draw.bind(this));\n    }\n\n    return this;\n  }\n\n  /**\n   * Actual implementation of drawing the layer.\n   * @private\n   */\n  async _draw() {\n    if (this.shouldMaskToScene) {\n      this._sceneMask = this._drawSceneMask();\n      this.addChild(this._sceneMask);\n      this._sceneMaskFilter = this._createSceneMaskFilter();\n    }\n\n    await this.drawWeather();\n    this.updateMask();\n  }\n\n  async drawWeather({ soft = false } = {}) {\n    if (!canvas.scene) {\n      return;\n    }\n    if (!this.weather) {\n      this.weather = this.addChild(new PIXI.Container());\n      if (this._sceneMaskFilter) {\n        this.weather.filters = [this._sceneMaskFilter];\n      }\n    }\n    Hooks.callAll(\"drawWeather\", this, this.weather, this.weatherEffects);\n\n    const stopPromise = Promise.all(\n      Object.entries(this.weatherEffects).map(async ([id, effect]) => {\n        if (soft) {\n          await effect.fx.fadeOut({ timeout: 20000 });\n        } else {\n          effect.fx.stop();\n        }\n        // The check is needed because a new effect might have been set already.\n        if (this.weatherEffects[id] === effect) {\n          delete this.weatherEffects[id];\n        }\n      }),\n    );\n\n    // Updating scene weather\n    const flags = canvas.scene.getFlag(packageId, \"effects\") ?? {};\n    for (const id in flags) {\n      if (!(flags[id].type in CONFIG.fxmaster.weather)) {\n        logger.warn(`Weather effect '${id}' is of unknown type '${flags[id].type}', skipping it.`);\n        continue;\n      }\n      const options = Object.fromEntries(\n        Object.entries(flags[id].options).map(([optionName, value]) => [optionName, { value }]),\n      );\n\n      this.weatherEffects[id] = {\n        type: flags[id].type,\n        fx: new CONFIG.fxmaster.weather[flags[id].type](this.weather, options),\n      };\n      this.weatherEffects[id].fx.play();\n    }\n\n    await stopPromise;\n  }\n\n  /**\n   * Draw the scene mask.\n   * @returns {CachedContainer}\n   * @private\n   */\n  _drawSceneMask() {\n    const cachedContainer = new CachedContainer();\n    const mask = new Graphics()\n      .beginFill(0xffffff)\n      .drawShape(canvas.dimensions.rect)\n      .endFill()\n      .beginHole()\n      .drawShape(intersectRectangles(canvas.dimensions.sceneRect, canvas.dimensions.rect))\n      .endHole();\n    cachedContainer.addChild(mask);\n    return cachedContainer;\n  }\n\n  /**\n   * Create the filter for applying the scene mask.\n   * @returns {InverseOcclusionMaskFilter | undefined} The filter for applying the scene mask or undefined if it doesn't exist\n   * @private\n   */\n  _createSceneMaskFilter() {\n    if (!this._sceneMask) {\n      return undefined;\n    }\n    const sceneMaskFilter = InverseOcclusionMaskFilter.create(\n      {\n        alphaOcclusion: 0,\n        uMaskSampler: this._sceneMask.renderTexture,\n      },\n      \"b\",\n    );\n    sceneMaskFilter.enabled = true;\n    return sceneMaskFilter;\n  }\n\n  /**\n   * This used to set the layer mask in v2.0.1 But has been replaced by using a filter instead.\n   * @deprecated since v2.0.2\n   */\n  _setLayerMask() {\n    logger.warn(\n      \"'canvas.fxmaster._setLayerMask' doesn't actually do anything anymore and is only kept for compatibility reasons. It will be removed in a futue version. Please don't use it anymore.\",\n    );\n  }\n\n  /** @deprecated since v2.0.0 */\n  _createInvertMask() {\n    logger.warn(\n      \"'canvas.fxmaster._createInvertMask' is deprecated and will be removed in a future version. Please use 'canvas.fxmaster._createInvertedMask' instead.\",\n    );\n    return this._createInvertedMask();\n  }\n}\n","/**\n * If the area of the intersection between the Rectangles `a` and `b` is not zero,\n * returns the area of intersection as a Rectangle object. Otherwise, returns an empty Rectangle\n * with its properties set to zero.\n * Rectangles without area (width or height equal to zero) can't intersect or be intersected\n * and will always return an empty rectangle with its properties set to zero.\n *\n * @method intersects\n * @memberof PIXI.Rectangle#\n * @param {Rectangle} a - The Rectangle to intersect with `b`.\n * @param {Rectangle} b - The Rectangle to intersect with `a`.\n * @param {Rectangle} [outRect] - A Rectangle object in which to store the value,\n * optional (otherwise will create a new Rectangle).\n * @returns {Rectangle} The intersection of `a` and `b`.\n * @remarks Incorporated from https://github.com/pixijs/pixijs/tree/dev/packages/math-extras\n * @license MIT\n */\nexport function intersectRectangles(a, b, outRect) {\n  if (!outRect) {\n    outRect = new PIXI.Rectangle();\n  }\n\n  const x0 = a.x < b.x ? b.x : a.x;\n  const x1 = a.right > b.right ? b.right : a.right;\n\n  if (x1 <= x0) {\n    outRect.x = outRect.y = outRect.width = outRect.height = 0;\n\n    return outRect;\n  }\n\n  const y0 = a.y < b.y ? b.y : a.y;\n  const y1 = a.bottom > b.bottom ? b.bottom : a.bottom;\n\n  if (y1 <= y0) {\n    outRect.x = outRect.y = outRect.width = outRect.height = 0;\n\n    return outRect;\n  }\n\n  outRect.x = x0;\n  outRect.y = y0;\n  outRect.width = x1 - x0;\n  outRect.height = y1 - y0;\n\n  return outRect;\n}\n","import { packageId } from \"../constants.js\";\nimport { logger } from \"../logger.js\";\nimport { resetFlags } from \"../utils.js\";\n\nclass FilterManager {\n  constructor() {\n    this.filterInfos = {};\n    this.filters = {};\n    this._ticker = false;\n    this.filteredLayers = {\n      background: true,\n      foreground: true,\n      drawings: true,\n      tokens: true,\n    };\n  }\n\n  /**\n   * Activate this {@link FilterManager}. This includes creating all the necessary filters, attaching them to the\n   * configured layers, starting their animations.\n   * @returns {Promise<void>} A promise that resolves as soon as filters are activated\n   */\n  async activate() {\n    await this.update({ skipFading: true });\n\n    if (!this._ticker) {\n      canvas.app.ticker.add(this._animate, this);\n      this._ticker = true;\n    }\n  }\n\n  /**\n   * Update the filters to the state that is configured for the active scene.\n   * @param {{skipFading?: boolean}} [options]            Additional options to configure this update\n   * @param {boolean}                [options.skipFading] Whether or not newly created filters should skip their fading\n   * @returns {Promise<void>}                             A promise that resolves as soon as the filters have been updated\n   */\n  async update({ skipFading = false } = {}) {\n    if (!canvas.scene) {\n      return;\n    }\n    this.filterInfos = Object.fromEntries(\n      Object.entries(canvas.scene.getFlag(packageId, \"filters\") ?? {}).filter(([id, filterInfo]) => {\n        if (!(filterInfo.type in CONFIG.fxmaster.filters)) {\n          logger.warn(`Filter effect '${id}' is of unknown type '${filterInfo.type}', skipping it.`);\n          return false;\n        }\n        return true;\n      }),\n    );\n    this.filteredLayers = canvas.scene.getFlag(packageId, \"filteredLayers\") ?? this.filteredLayers;\n\n    const filtersToCreate = Object.keys(this.filterInfos).filter((key) => !(key in this.filters));\n    const filtersToUpdate = Object.keys(this.filterInfos).filter((key) => key in this.filters);\n    const filtersToDelete = Object.keys(this.filters).filter((key) => !(key in this.filterInfos));\n\n    for (const key of filtersToCreate) {\n      const { type, options } = this.filterInfos[key];\n      this.filters[key] = new CONFIG.fxmaster.filters[type](options, key);\n      this.filters[key].skipFading = skipFading;\n      this.filters[key].play();\n    }\n\n    for (const key of filtersToUpdate) {\n      const { options } = this.filterInfos[key];\n      const filter = this.filters[key];\n      filter.configure(options);\n      filter.play();\n    }\n\n    const deletePromises = filtersToDelete.map(async (key) => {\n      const filter = this.filters[key];\n      await filter.stop();\n\n      // delete filters preemptively so that they disappear as soon as they have stopped\n      [canvas.background, canvas.foreground, canvas.drawings, canvas.tokens].forEach((layer) =>\n        FilterManager._removeFilterFromContainer(layer, filter),\n      );\n      delete this.filters[key];\n    });\n    await Promise.all(deletePromises);\n\n    this.applyFiltersToLayers();\n  }\n\n  /**\n   * Apply the filters to the configured canvas layers.\n   * @returns {void} Nothing\n   */\n  applyFiltersToLayers() {\n    const filters = Object.values(this.filters);\n    Object.entries(this.filteredLayers).forEach(([layerName, filtered]) => {\n      const layer = canvas[layerName];\n      const otherFilters = layer.filters?.filter((f) => !filters.includes(f)) ?? [];\n      layer.filters = otherFilters.concat(filtered ? filters : []);\n    });\n  }\n\n  /**\n   * Remove a filter from a container.\n   * @param {PIXI.container} container A container\n   * @param {PIXI.Filter} filter A filter\n   */\n  static _removeFilterFromContainer(container, filter) {\n    container.filters = container.filters?.filter((f) => f !== filter) ?? null;\n  }\n\n  /**\n   * Set the filters stored in the scene's fxmaster flags to the current values of `filterInfos` of this\n   * {@link FilterManager}.\n   * @returns {Promise<void>} A promise that resolves as soon as the scene's fxmaster flags have been updated\n   */\n  async dump() {\n    await resetFlags(canvas.scene, \"filters\", this.filterInfos);\n  }\n\n  /**\n   * Stop all filters and remove them from the manager.\n   * @remarks This does _not_ remove the filters from the canvas layers.\n   * @returns {Promise<void>} A promise that resolves as soon as all filters have been stopped and removed from the\n   *                          manager\n   */\n  async clear() {\n    const promises = Object.values(this.filters).map((filter) => filter.stop());\n    this.filters = {};\n    await Promise.all(promises);\n  }\n\n  /**\n   * Add a named filter.\n   * @param {string} name    The name of the filter\n   * @param {string} type    The type of the filter\n   * @param {object} options The options for the filter\n   * @returns {Prmise<void>} A promise that resolves as soon as the filter has been added to the scene's fxmaster flags\n   */\n  async addFilter(name, type, options) {\n    name = name ?? randomID();\n    this.filterInfos[name] = { type, options };\n    await this.dump();\n  }\n\n  /**\n   * Remove a named filter.\n   * @param {string} name     The name of the filter to remove\n   * @returns {Promise<void>} A promise that resolves when the filter has been removed from the scene's fxmaster flags\n   */\n  async removeFilter(name) {\n    if (!canvas.scene) {\n      return;\n    }\n    const filter = this.filters[name];\n    if (filter) {\n      await filter.stop();\n    }\n    const rmFilter = {\n      [`-=${name}`]: null,\n    };\n    await canvas.scene.setFlag(packageId, \"filters\", rmFilter);\n  }\n\n  /**\n   * Remove all filters.\n   * @returns {Promise<void>} A promise that resolves as soon as all filters have been removed from the scene's fxmaster\n   *                          flags\n   */\n  async removeAll() {\n    if (!canvas.scene) {\n      return;\n    }\n    await canvas.scene.unsetFlag(packageId, \"filters\");\n  }\n\n  /**\n   * Toggle a named filter on or off.\n   * @param {string} name     The name of the filter\n   * @param {string} type     The type of the filter\n   * @param {object} options  The options for the filter\n   * @returns {Promise<void>} A promise that resolves as soon as the filter has been toggled\n   */\n  async switch(name, type, options) {\n    if (this.filterInfos[name]) {\n      return this.removeFilter(name);\n    }\n    return this.addFilter(name, type, options);\n  }\n\n  async setFilters(filterInfoArray) {\n    this.filterInfos = Object.fromEntries(filterInfoArray.map((filterInfo) => [foundry.utils.randomID(), filterInfo]));\n    await this.dump();\n  }\n\n  _animate() {\n    for (const key in this.filters) {\n      this.filters[key].step();\n    }\n  }\n\n  /**\n   * @deprecated since v2.0.0\n   */\n  get apply_to() {\n    logger.warn(\n      \"'FXMASTER.filters.apply_to' is deprecated and will be removed in a future version. Please use 'FXMASTER.filters.filteredLayers' instead.\",\n    );\n    return this.filteredLayers;\n  }\n}\n\nexport const filterManager = new FilterManager();\n","import { easeFunctions } from \"../../ease.js\";\nimport { packageId } from \"../../constants.js\";\n\nexport class SpecialCreate extends FormApplication {\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\"],\n      closeOnSubmit: true,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 320,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/special-create.hbs\",\n      id: \"add-effect\",\n      title: game.i18n.localize(\"FXMASTER.AddSpecialEffect\"),\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  setDefault(object) {\n    this.default = object;\n  }\n\n  /**\n   * Obtain module metadata and merge it with game settings which track current module visibility\n   * @return {Object}   The data provided to the template when rendering the form\n   */\n  getData() {\n    const eases = easeFunctions;\n    const values = foundry.utils.mergeObject(\n      {\n        folder: \"Custom\",\n        angle: 0,\n        position: {\n          x: 0,\n          y: 0,\n        },\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        speed: 0,\n        animationDelay: {\n          start: 0,\n          end: 0,\n        },\n        ease: \"Linear\",\n        author: \"\",\n        preset: false,\n      },\n      this.default,\n    );\n\n    // Return data to the template\n    return {\n      default: values,\n      ease: Object.keys(eases),\n    };\n  }\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers                */\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find('input[type=\"range\"]').on(\"input\", (event) => this._onChangeRange(event));\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated\n   * @param event {Event}       The initial triggering submission event\n   * @param formData {object}   The object of validated form data with which to update the object\n   * @protected\n   */\n  async _updateObject(_, formData) {\n    const fxs = game.settings.get(packageId, \"specialEffects\");\n\n    const newData = {\n      folder: formData[\"folder\"],\n      label: formData[\"label\"],\n      file: formData[\"file\"],\n      scale: {\n        x: parseFloat(formData[\"scaleX\"]),\n        y: parseFloat(formData[\"scaleY\"]),\n      },\n      angle: parseFloat(formData[\"angle\"]),\n      anchor: {\n        x: formData[\"anchorX\"],\n        y: formData[\"anchorY\"],\n      },\n      speed: parseFloat(formData[\"speed\"]),\n      animationDelay: {\n        start: parseFloat(formData[\"animationDelayStart\"]),\n        end: parseFloat(formData[\"animationDelayEnd\"]),\n      },\n      ease: formData[\"ease\"],\n      preset: false,\n      author: \"\",\n    };\n    const fx = fxs.filter((f) => f.label == newData.label);\n    if (fx.length > 0) {\n      fx[0] = foundry.utils.mergeObject(fx[0], newData);\n    } else {\n      fxs.push(newData);\n    }\n    await game.settings.set(packageId, \"specialEffects\", fxs);\n  }\n}\n","import { SpecialCreate } from \"./specials-create.js\";\nimport \"../../../css/specials-config.css\";\nimport { packageId } from \"../../constants.js\";\n\nexport class SpecialsConfig extends Application {\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"fxmaster\", \"specials\", \"sidebar-popout\"],\n      closeOnSubmit: true,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 120,\n      height: 200,\n      resizable: true,\n      dragDrop: [{ dragSelector: \".special-effects\" }],\n      template: \"modules/fxmaster/templates/specials-config.hbs\",\n      id: \"specials-config\",\n      title: game.i18n.localize(\"FXMASTER.SpecialsConfigTitle\"),\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Obtain module metadata and merge it with game settings which track current module visibility\n   * @return {Object}   The data provided to the template when rendering the form\n   */\n  getData() {\n    return {\n      folders: CONFIG.fxmaster.userSpecials,\n    };\n  }\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers                */\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    html.find(\".special-effects .description\").click((event) => {\n      let list = event.currentTarget.closest(\".directory-list\");\n      let items = $(list).find(\".directory-item\");\n      for (let i = 0; i < items.length; i++) {\n        items[i].classList.remove(\"active\");\n      }\n      event.currentTarget.parentElement.classList.add(\"active\");\n    });\n\n    // Dialog\n    html.find(\"a[data-action=add-effect]\").click(async () => {\n      new SpecialCreate().render(true);\n    });\n\n    html.find(\".preview video\").hover((ev) => {\n      ev.currentTarget.play();\n    });\n\n    html.find(\".del-effect\").click((ev) => {\n      const folderId = ev.currentTarget.closest(\".folder\").dataset[\"folderId\"];\n      const effectId = ev.currentTarget.closest(\".special-effects\").dataset[\"effectId\"];\n      const data = CONFIG.fxmaster.userSpecials[folderId].effects[effectId];\n      const settings = game.settings.get(packageId, \"specialEffects\");\n      const id = settings.findIndex((v) => {\n        return v.label === data.label && v.folder === data.folder;\n      });\n      if (id === -1) {\n        return;\n      }\n      settings.splice(id, 1);\n      game.settings.set(packageId, \"specialEffects\", settings);\n    });\n\n    html.find(\".edit-effect\").click((ev) => {\n      const folderId = ev.currentTarget.closest(\".folder\").dataset[\"folderId\"];\n      const effectId = ev.currentTarget.closest(\".special-effects\").dataset[\"effectId\"];\n      const d = new SpecialCreate();\n      d.setDefault(CONFIG.fxmaster.userSpecials[folderId].effects[effectId]);\n      d.render(true);\n    });\n\n    html.find(\".action-toggle\").click((ev) => {\n      for (const c of ev.currentTarget.parentElement.children) {\n        c.classList.remove(\"active\");\n      }\n      ev.currentTarget.classList.add(\"active\");\n    });\n\n    const directory = html.find(\".directory-list\");\n    directory.on(\"click\", \".folder-header\", this._toggleFolder.bind(this));\n  }\n\n  _toggleFolder(event) {\n    let folder = $(event.currentTarget.parentElement);\n    let collapsed = folder.hasClass(\"collapsed\");\n\n    // Expand\n    if (collapsed) folder.removeClass(\"collapsed\");\n    // Collapse\n    else {\n      folder.addClass(\"collapsed\");\n      folder.find(\".folder\").addClass(\"collapsed\");\n    }\n  }\n\n  _onDragStart(event) {\n    const effectId = event.currentTarget.closest(\".special-effects\").dataset.effectId;\n    const folderId = event.currentTarget.closest(\".folder\").dataset.folderId;\n    const effectData = CONFIG.fxmaster.userSpecials[folderId].effects[effectId];\n    effectData.type = \"SpecialEffect\";\n    event.dataTransfer.setData(\"text/plain\", JSON.stringify(effectData));\n  }\n}\n","import { FXCanvasAnimation } from \"../canvasanimation.js\";\nimport { packageId } from \"../constants.js\";\nimport { easeFunctions } from \"../ease.js\";\n\nexport class SpecialsLayer extends CanvasLayer {\n  constructor() {\n    super();\n    this.videos = [];\n    this._dragging = false;\n    this.ruler = null;\n    this.windowVisible = false;\n    // Listen to the socket\n    game.socket.on(`module.${packageId}`, (data) => {\n      this.playVideo(data);\n    });\n  }\n\n  static get layerOptions() {\n    return foundry.utils.mergeObject(super.layerOptions, {\n      name: \"specials\",\n      zIndex: 245,\n    });\n  }\n\n  /** @override */\n  async draw() {\n    await super.draw();\n    this.ruler = this.addChild(new PIXI.Graphics());\n    this.visible = true;\n    return this;\n  }\n\n  /** @inheritdoc */\n  async tearDown() {\n    this.ruler = null;\n    for (const video of this.videos) {\n      video.remove();\n    }\n    this.videos = [];\n    return super.tearDown();\n  }\n\n  _configureProjectile(vidSprite, data) {\n    if (data.distance && (!data.speed || data.speed == \"auto\")) {\n      data.speed = data.distance / data.duration;\n    }\n    // Compute final position\n    const delta = data.duration * data.speed;\n    const deltaX = delta * Math.cos(data.rotation);\n    const deltaY = delta * Math.sin(data.rotation);\n\n    // Move the sprite\n    const attributes = [\n      {\n        parent: vidSprite,\n        attribute: \"x\",\n        to: data.position.x + deltaX,\n      },\n      {\n        parent: vidSprite,\n        attribute: \"y\",\n        to: data.position.y + deltaY,\n      },\n    ];\n\n    let animationDuration = data.duration * 1000;\n    if (foundry.utils.hasProperty(data, \"animationDelay\")) {\n      animationDuration -= Math.max(0, 1000 * (data.animationDelay.end + data.animationDelay.start));\n    }\n    const animate = function () {\n      FXCanvasAnimation.animateSmooth(attributes, {\n        name: `${packageId}.video.${randomID()}.move`,\n        context: this,\n        duration: animationDuration,\n        ease: easeFunctions[data.ease],\n      });\n    };\n    if (foundry.utils.hasProperty(data, \"animationDelay.start\")) {\n      setTimeout(animate, data.animationDelay.start * 1000.0);\n    } else {\n      animate();\n    }\n  }\n\n  _configureRotate(vidSprite, data) {\n    const attributes = [\n      {\n        parent: vidSprite,\n        attribute: \"angle\",\n        to: 90 * data.rotationSpeed,\n      },\n    ];\n    let animationDuration = data.duration * 1000;\n    if (foundry.utils.hasProperty(data, \"animationDelay\")) {\n      animationDuration -= Math.max(0, 1000 * (data.animationDelay.end + data.animationDelay.start));\n    }\n    const animate = function () {\n      FXCanvasAnimation.animateSmooth(attributes, {\n        name: `${packageId}.video.${randomID()}.rotate`,\n        context: this,\n        duration: animationDuration,\n        ease: easeFunctions[data.ease],\n      });\n    };\n    if (foundry.utils.hasProperty(data, \"animationDelay.start\")) {\n      setTimeout(animate, data.animationDelay.start * 1000.0);\n    } else {\n      animate();\n    }\n  }\n\n  _configureSprite(vidSprite, data) {\n    // Set values\n    vidSprite.anchor.set(data.anchor.x, data.anchor.y);\n    vidSprite.rotation = Math.normalizeRadians(data.rotation - Math.toRadians(data.angle));\n    vidSprite.scale.set(data.scale.x, data.scale.y);\n    vidSprite.position.set(data.position.x, data.position.y);\n\n    // Extend sprite if a width is forced\n    if (data.width) {\n      if (data.keepAspect) {\n        const aspectRatio = vidSprite.height / vidSprite.width;\n        vidSprite.height = data.width * aspectRatio;\n      }\n      vidSprite.width = data.width;\n    }\n\n    if (data.speed || data.distance) {\n      this._configureProjectile(vidSprite, data);\n    }\n    if (data.rotationSpeed) {\n      this._configureRotate(vidSprite, data);\n    }\n  }\n\n  playVideo(data) {\n    return new Promise((resolve) => {\n      // Set default values\n      data = foundry.utils.mergeObject(\n        {\n          anchor: { x: 0.5, y: 0.5 },\n          rotation: 0,\n          scale: { x: 1.0, y: 1.0 },\n          position: { x: 0, y: 0 },\n          playbackRate: 1.0,\n          ease: \"Linear\",\n        },\n        data,\n      );\n\n      // Create video\n      const video = document.createElement(\"video\");\n      video.preload = \"auto\";\n      video.crossOrigin = \"anonymous\";\n      video.src = data.file;\n      video.playbackRate = data.playbackRate;\n      this.videos.push(video);\n\n      // Create PIXI sprite\n      let vidSprite;\n      video.oncanplay = () => {\n        const texture = PIXI.Texture.from(video);\n        vidSprite = new PIXI.Sprite(texture);\n        this.addChild(vidSprite);\n        data.dimensions = { w: video.videoWidth, h: video.videoHeight };\n        data.duration = video.duration;\n        this._configureSprite(vidSprite, data);\n      };\n      video.onerror = () => {\n        this.removeChild(vidSprite);\n        resolve();\n        vidSprite?.destroy();\n      };\n      video.onended = () => {\n        this.removeChild(vidSprite);\n        vidSprite?.destroy();\n        resolve();\n      };\n    });\n  }\n\n  static _createMacro(effectData) {\n    return `\n      const data = {\n        file: \"${effectData.file}\",\n        position: {\n          x: canvas.scene.dimensions.width / 2,\n          y: canvas.scene.dimensions.height / 2\n        },\n        anchor : {\n          x: ${effectData.anchor.x},\n          y: ${effectData.anchor.y}\n        },\n        angle: ${effectData.angle},\n        speed: ${effectData.speed},\n        scale: {\n          x: ${effectData.scale.x},\n          y: ${effectData.scale.y}\n        }\n      };\n      const tokens = canvas.tokens.controlled;\n      // No tokens are selected, play in a random position\n      if (tokens.length === 0) {\n        canvas.specials.playVideo(data);\n        game.socket.emit(\"module.${packageId}\", data);\n        return;\n      }\n      const targets = game.user.targets;\n      if (targets.size !== 0) {\n        tokens.forEach(t1 => {\n          targets.forEach(t2 => {\n            canvas.specials.drawFacing(data, t1, t2);\n          })\n        })\n        return;\n      }\n      // Play effect on each token\n      tokens.forEach(t => {\n        data.position = {\n          x: t.position.x + t.w / 2,\n          y: t.position.y + t.h / 2\n        };\n        canvas.specials.playVideo(data);\n        game.socket.emit(\"module.${packageId}\", data);\n      })\n\n    `;\n  }\n\n  drawSpecialToward(effect, tok1, tok2) {\n    const origin = {\n      x: tok1.position.x + tok1.w / 2,\n      y: tok1.position.y + tok1.h / 2,\n    };\n    const effectData = foundry.utils.mergeObject(effect, {\n      position: {\n        x: origin.x,\n        y: origin.y,\n      },\n    });\n    const target = {\n      x: tok2.position.x + tok2.w / 2,\n      y: tok2.position.y + tok2.h / 2,\n    };\n    // Compute angle\n    const ray = new Ray(origin, target);\n    effectData.distance = ray.distance;\n    effectData.rotation = ray.angle;\n    // Play to other clients\n    game.socket.emit(`module.${packageId}`, effectData);\n    // Play effect locally\n    return this.playVideo(effectData);\n  }\n\n  drawFacing(effect, tok1, tok2) {\n    const origin = {\n      x: tok1.position.x + tok1.w / 2,\n      y: tok1.position.y + tok1.h / 2,\n    };\n    const effectData = foundry.utils.mergeObject(effect, {\n      position: {\n        x: origin.x,\n        y: origin.y,\n      },\n    });\n    const target = {\n      x: tok2.position.x + tok2.w / 2,\n      y: tok2.position.y + tok2.h / 2,\n    };\n    // Compute angle\n    const ray = new Ray(origin, target);\n    effectData.rotation = ray.angle;\n    // Play to other clients\n    game.socket.emit(`module.${packageId}`, effectData);\n    // Play effect locally\n    return this.playVideo(effectData);\n  }\n\n  /**\n   * Draw a special effect.\n   * @param {PIXI.InteractionEvent} event         The event that triggered the drawing of the special effect\n   * @param {PIXI.Point}            [savedOrigin] The point that was originally clicked on\n   * @returns {Promise<void>}\n   * @remarks\n   * The savedOrigin parameter is required for regular click events because for some reason, the origin has been removed\n   * from the event's data by the time the event is handled.\n   * TODO: investigate further.\n   */\n  _drawSpecial(event, savedOrigin) {\n    event.stopPropagation();\n\n    const windows = Object.values(ui.windows);\n    const effectConfig = windows.find((w) => w.id == \"specials-config\");\n    if (!effectConfig) return;\n    const active = effectConfig.element.find(\".special-effects.active\");\n    if (active.length == 0) return;\n\n    const id = active[0].dataset.effectId;\n    const folder = active[0].closest(\".folder\").dataset.folderId;\n    const effect = CONFIG.fxmaster.userSpecials[folder].effects[id];\n\n    const effectData = foundry.utils.deepClone(effect);\n    const { x, y } = event.data.origin ?? savedOrigin;\n    const data = {\n      ...effectData,\n      ...{\n        position: { x, y },\n        rotation: event.data.rotation,\n      },\n    };\n\n    if (!event.data.destination) {\n      game.socket.emit(`module.${packageId}`, data);\n      return this.playVideo(data);\n    }\n\n    // Handling different casting modes\n    const actionToggle = effectConfig.element.find(\".action-toggle.active a\");\n    const mode = actionToggle[0].dataset.action;\n    const ray = new Ray(event.data.origin, event.data.destination);\n    switch (mode) {\n      case \"cast-throw\":\n        data.distance = ray.distance;\n        data.speed = \"auto\";\n        break;\n      case \"cast-extend\":\n        data.width = ray.distance || data.width;\n        data.speed = 0;\n        break;\n      case \"cast-expand\":\n        data.width = ray.distance || data.width;\n        data.keepAspect = true;\n        data.speed = 0;\n        break;\n      case \"cast-rotate\":\n        data.rotationSpeed = ray.distance / canvas.grid.w;\n        data.speed = 0;\n        break;\n      case \"cast-static\":\n        break;\n    }\n\n    game.socket.emit(`module.${packageId}`, data);\n    return this.playVideo(data);\n  }\n\n  /** @override */\n  _onDragLeftDrop(event) {\n    const u = {\n      x: event.data.destination.x - event.data.origin.x,\n      y: event.data.destination.y - event.data.origin.y,\n    };\n    const cos = u.x / Math.hypot(u.x, u.y);\n    event.data.rotation = u.y > 0 ? Math.acos(cos) : -Math.acos(cos);\n    this._drawSpecial(event);\n    this.ruler.clear();\n  }\n\n  /** @override */\n  _onDragLeftStart() {\n    this.windowVisible = this._isWindowVisible();\n    if (!this.windowVisible) return;\n    this._dragging = true;\n  }\n\n  _onDragLeftMove(event) {\n    if (!this.windowVisible) return;\n    const ray = new Ray(event.data.origin, event.data.destination);\n    this.ruler.clear();\n    this.ruler\n      .lineStyle(3, 0xaa0033, 0.6)\n      .drawCircle(ray.A.x, ray.A.y, 2)\n      .moveTo(ray.A.x, ray.A.y)\n      .lineTo(ray.B.x, ray.B.y)\n      .drawCircle(ray.B.x, ray.B.y, 2);\n  }\n\n  _isWindowVisible() {\n    const windows = Object.values(ui.windows);\n    const effectConfig = windows.find((w) => w.id == \"specials-config\");\n    if (!effectConfig) return false;\n    return true;\n  }\n\n  _onClickLeft(event) {\n    this._dragging = false;\n    const origin = event.data.origin;\n    setTimeout(() => {\n      if (!this._dragging) {\n        event.data.rotation = 0;\n        event.data.destination = undefined;\n        this._drawSpecial(event, origin);\n      }\n      this._dragging = false;\n    }, 400);\n  }\n}\n","/**\n * An abstract FormApplication that handles functionality common to multiple FXMaster forms.\n * In particular, it provides the following functionality:\n * * Handling of collapsible elements\n * * Making slider changes for range inputs update the accompanying text box immediately\n * * Handling the disabled state of the submission button\n *\n * @extends FormApplication\n * @abstract\n * @interface\n *\n * @param {Object} object                     Some object which is the target data structure to be be updated by the form.\n * @param {FormApplicationOptions} [options]  Additional options which modify the rendering of the sheet.\n */\nexport class FXMasterBaseForm extends FormApplication {\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html\n      .find(\".fxmaster-groups-list__collapse\")\n      .click((event) =>\n        this._onClickCollapse(\n          event,\n          \"fxmaster-groups-list__item\",\n          \"fxmaster-groups-list__collapsible\",\n          \"fxmaster-groups-list__collapse-icon\",\n        ),\n      );\n    html\n      .find(\".fxmaster-list__collapse\")\n      .click((event) =>\n        this._onClickCollapse(\n          event,\n          \"fxmaster-list__item\",\n          \"fxmaster-list__collapsible\",\n          \"fxmaster-list__collapse-icon\",\n        ),\n      );\n    html.find(\".fxmaster-range-input\").on(\"input\", this._onChangeRange.bind(this));\n  }\n\n  /**\n   * Handle toggling a a collapsible. To collapse the collapsible, the class `${collapsibleClass}--collapsed` is\n   * added to it.\n   *\n   * @param {JQuery.ClickEvent} event            The originating click event\n   * @param {string}            parentClass      The CSS class for selecting the parent that contains both the collapse\n   *                                             \"button\" and the collapsible\n   * @param {string}            collapsibleClass The CSS class for selecting the collapsible inside the parent\n   * @param {string}            [iconClass]      An optional CSS class to select an up/down arrow icon to be toggled\n   * @private\n   */\n  _onClickCollapse(event, parentClass, collapsibleClass, iconClass) {\n    const parentItem = $(event.currentTarget).parents(`.${parentClass}`);\n    const collapsible = parentItem.children(`.${collapsibleClass}`);\n    const icon = iconClass !== undefined ? parentItem.find(`.${iconClass}`) : undefined;\n    this._collapse(collapsible, icon, `${collapsibleClass}--collapsed`);\n  }\n\n  /**\n   * Toggle the collapsed state of an element.\n   * @param {JQuery}      collapsible                 The element to collapse\n   * @param {JQuery|null} [icon]                      An up/down arrow icon to be toggled\n   * @param {string}      [collapsedClass=\"collaped\"] The CSS clas to use to mark the element as collapsed\n   * @param {number}      [speed=250]                 The speed for sliding the element in and out, in milliseconds\n   * @private\n   */\n  _collapse(collapsible, icon, collapsedClass = \"collapsed\", speed = 250) {\n    const shouldCollapse = !collapsible.hasClass(collapsedClass);\n\n    if (shouldCollapse) {\n      collapsible.slideUp(speed, () => {\n        collapsible.addClass(collapsedClass);\n        icon?.removeClass(\"fa-angle-down\").addClass(\"fa-angle-up\");\n      });\n    } else {\n      collapsible.slideDown(speed, () => {\n        collapsible.removeClass(collapsedClass);\n        icon?.removeClass(\"fa-angle-up\").addClass(\"fa-angle-down\");\n      });\n    }\n  }\n\n  /** @override */\n  async _onChangeInput(...args) {\n    this.element.find('button[type=\"submit\"]').prop(\"disabled\", false);\n    return super._onChangeInput(...args);\n  }\n\n  /** @override */\n  async _onSubmit(...args) {\n    this.element.find('button[type=\"submit\"]').prop(\"disabled\", true);\n    return super._onSubmit(...args);\n  }\n}\n","import \"../../../css/weather-config.css\";\n\nimport { packageId } from \"../../constants.js\";\nimport { FXMasterBaseForm } from \"../../base-form.js\";\nimport { resetFlags } from \"../../utils.js\";\n\nexport class WeatherConfig extends FXMasterBaseForm {\n  /** @override */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\", \"fxmaster\", \"weathers\", \"sidebar-popout\"],\n      closeOnSubmit: false,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 300,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/weather-config.hbs\",\n      id: \"effects-config\",\n      title: game.i18n.localize(\"FXMASTER.WeatherConfigTitle\"),\n    });\n  }\n\n  /** @override */\n  getData() {\n    const currentParticleEffects = canvas.scene?.getFlag(packageId, \"effects\") ?? {};\n\n    const activeParticleEffects = Object.fromEntries(\n      Object.values(currentParticleEffects).map((effect) => [effect.type, effect.options]),\n    );\n\n    /** @type {import(\"../weatherDB.js\").WeatherDB} */\n    const weather = CONFIG.fxmaster.weather;\n\n    /** @type {Record<string, {label: string, expanded: boolean, effects: import(\"../weatherDB.js\").WeatherDB}>}} */\n    const initialWeatherEffectGroups = {};\n\n    const weatherEffectGroups = Object.entries(weather)\n      .sort(([, clsA], [, clsB]) => clsA.group.localeCompare(clsB.group) || clsA.label.localeCompare(clsB.label))\n      .reduce((groups, [type, cls]) => {\n        const group = cls.group;\n        return {\n          ...groups,\n          [group]: {\n            label: `FXMASTER.WeatherEffectsGroup${group.titleCase()}`,\n            expanded: groups[group]?.expanded || Object.keys(activeParticleEffects).includes(type),\n            effects: {\n              ...groups[group]?.effects,\n              [type]: cls,\n            },\n          },\n        };\n      }, initialWeatherEffectGroups);\n\n    return {\n      weatherEffectGroups: weatherEffectGroups,\n      effects: weather,\n      activeEffects: activeParticleEffects,\n    };\n  }\n\n  /** @override */\n  async _updateObject(_, formData) {\n    /** @type {import(\"../weatherDB.js\").WeatherDB} */\n    const weathersDB = CONFIG.fxmaster.weather;\n    const effects = Object.fromEntries(\n      Object.entries(weathersDB)\n        .filter(([, weatherCls]) => !!formData[weatherCls.label])\n        .map(([weatherName, weatherCls]) => {\n          const label = weatherCls.label;\n\n          const options = Object.fromEntries(\n            Object.entries(weatherCls.parameters).map(([key, parameter]) => {\n              const optionValue =\n                parameter.type === \"color\"\n                  ? { apply: formData[`${label}_${key}_apply`], value: formData[`${label}_${key}`] }\n                  : formData[`${label}_${key}`];\n\n              return [key, optionValue];\n            }),\n          );\n\n          const weather = {\n            type: weatherName,\n            options,\n          };\n          return [`core_${weatherName}`, weather];\n        }),\n    );\n    resetFlags(canvas.scene, \"effects\", effects);\n  }\n}\n","import \"../../../css/filters-config.css\";\n\nimport { packageId } from \"../../constants.js\";\nimport { FXMasterBaseForm } from \"../../base-form.js\";\nimport { resetFlags } from \"../../utils.js\";\n\nexport class FiltersConfig extends FXMasterBaseForm {\n  /** @override */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\", \"fxmaster\", \"filters\", \"sidebar-popout\"],\n      closeOnSubmit: false,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 300,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/filters-config.hbs\",\n      id: \"filters-config\",\n      title: game.i18n.localize(\"FXMASTER.FiltersConfigTitle\"),\n    });\n  }\n\n  /** @override */\n  getData() {\n    const currentFilters = canvas.scene?.getFlag(packageId, \"filters\") ?? {};\n    const activeFilters = Object.fromEntries(\n      Object.values(currentFilters).map((filter) => [filter.type, filter.options]),\n    );\n\n    const filteredLayers = canvas.scene?.getFlag(packageId, \"filteredLayers\") ?? {\n      background: true,\n      foreground: true,\n      tokens: true,\n      drawings: true,\n    };\n\n    const filters = Object.fromEntries(\n      Object.entries(CONFIG.fxmaster.filters).sort(([, clsA], [, clsB]) => clsA.label.localeCompare(clsB.label)),\n    );\n\n    return {\n      filters,\n      activeFilters,\n      filteredLayers,\n    };\n  }\n\n  /** @override */\n  async _updateObject(_, formData) {\n    if (!canvas.scene) {\n      return;\n    }\n    const filtersDB = CONFIG.fxmaster.filters;\n\n    const filters = Object.fromEntries(\n      Object.entries(filtersDB)\n        .filter(([, filterCls]) => !!formData[filterCls.label])\n        .map(([filterName, filterCls]) => {\n          const label = filterCls.label;\n\n          const options = Object.fromEntries(\n            Object.entries(filterCls.parameters).map(([key, parameter]) => {\n              const optionValue =\n                parameter.type === \"color\"\n                  ? { apply: formData[`${label}_${key}_apply`], value: formData[`${label}_${key}`] }\n                  : formData[`${label}_${key}`];\n\n              return [key, optionValue];\n            }),\n          );\n\n          const filter = {\n            type: filterName,\n            options,\n          };\n          return [`core_${filterName}`, filter];\n        }),\n    );\n\n    const filteredLayers = {\n      background: formData[\"background\"],\n      foreground: formData[\"foreground\"],\n      drawings: formData[\"drawings\"],\n      tokens: formData[\"tokens\"],\n    };\n\n    await canvas.scene.setFlag(packageId, \"filteredLayers\", filteredLayers);\n    resetFlags(canvas.scene, \"filters\", filters);\n  }\n}\n","import { packageId } from \"./constants.js\";\n\nconst defaultMacroImg = \"icons/svg/windmill.svg\";\n\nexport async function saveWeatherAndFiltersAsMacro() {\n  const weatherFlags = canvas.scene?.getFlag(packageId, \"effects\") ?? {};\n  const weatherEffects = Object.values(weatherFlags);\n\n  const filterFlags = canvas.scene?.getFlag(packageId, \"filters\") ?? {};\n  const filterEffects = Object.values(filterFlags);\n\n  const { name, img } = getMacroNameAndImg(weatherEffects, filterEffects);\n\n  const commands = [];\n  if (weatherEffects.length > 0) {\n    commands.push(`Hooks.call('${packageId}.updateWeather', ${JSON.stringify(weatherEffects)});`);\n  }\n  if (filterEffects.length > 0) {\n    commands.push(`FXMASTER.filters.setFilters(${JSON.stringify(filterEffects)});`);\n  }\n  const command = commands.join(\"\\n\");\n\n  await Macro.create({ type: \"script\", name, command, img });\n  ui.notifications.info(`Macro ${name} has been saved in the macro directory`);\n}\n\nfunction getMacroNameAndImg(weatherEffects, filterEffects) {\n  const weatherLabelsAndIcons = weatherEffects.flatMap(({ type }) => {\n    const weatherEffectCls = CONFIG.fxmaster.weather[type];\n    if (!weatherEffectCls) {\n      logger.warn(`Encountered unknown weather effect type '${type}' during macro creation, skipping it.`);\n      return [];\n    }\n    return [{ label: weatherEffectCls.label, icon: weatherEffectCls.icon }];\n  });\n  const filterLabels = filterEffects.flatMap(({ type }) => {\n    const filterEffectCls = CONFIG.fxmaster.filters[type];\n    if (!filterEffectCls) {\n      logger.warn(`Encountered unknown filter effect type '${type}' during macro creation, skipping it.`);\n      return [];\n    }\n    return [{ label: filterEffectCls.label }];\n  });\n\n  if (filterLabels.length === 0) {\n    return weatherLabelsAndIcons.length === 1\n      ? {\n          name: `Weather: ${weatherLabelsAndIcons[0].label}`,\n          img: weatherLabelsAndIcons[0].icon,\n        }\n      : { name: \"Weather\", img: defaultMacroImg };\n  } else if (weatherLabelsAndIcons.length === 0) {\n    return filterLabels.length === 1\n      ? {\n          name: `Filter: ${filterLabels[0].label}`,\n          img: defaultMacroImg,\n        }\n      : { name: \"Filters\", img: defaultMacroImg };\n  } else {\n    return { name: `Weather & Filters`, img: defaultMacroImg };\n  }\n}\n","import { packageId } from \"./constants.js\";\nimport { filterManager } from \"./filterEffects/FilterManager.js\";\nimport { WeatherConfig } from \"./weatherEffects/applications/weather-config.js\";\nimport { SpecialsConfig } from \"./specialEffects/applications/specials-config.js\";\nimport { FiltersConfig } from \"./filterEffects/applications/filters-config.js\";\nimport { saveWeatherAndFiltersAsMacro } from \"./macro.js\";\n\nexport function registerGetSceneControlButtonsHook() {\n  Hooks.on(\"getSceneControlButtons\", getSceneControlButtons);\n}\n\nfunction getSceneControlButtons(controls) {\n  if (canvas == null) {\n    return;\n  }\n  controls.push({\n    name: \"effects\",\n    title: \"CONTROLS.Effects\",\n    icon: \"fas fa-magic\",\n    layer: \"specials\",\n    visible: game.user.role >= game.settings.get(packageId, \"permission-create\"),\n    tools: [\n      {\n        name: \"specials\",\n        title: \"CONTROLS.SpecialFX\",\n        icon: \"fas fa-hat-wizard\",\n        onClick: () => {\n          new SpecialsConfig().render(true);\n        },\n        button: true,\n      },\n      {\n        name: \"weather\",\n        title: \"CONTROLS.Weather\",\n        icon: \"fas fa-cloud-rain\",\n        onClick: () => {\n          new WeatherConfig().render(true);\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"invertmask\",\n        title: \"CONTROLS.InvertMask\",\n        icon: \"fas fa-mask\",\n        onClick: () => {\n          if (canvas.scene) {\n            const invert = canvas.scene.getFlag(packageId, \"invert\") ?? false;\n            canvas.scene.setFlag(packageId, \"invert\", !invert);\n          }\n        },\n        visible: game.user.isGM,\n        active: canvas.scene?.getFlag(packageId, \"invert\") ?? false,\n        toggle: true,\n      },\n      {\n        name: \"filters\",\n        title: \"CONTROLS.Filters\",\n        icon: \"fas fa-filter\",\n        onClick: () => {\n          new FiltersConfig().render(true);\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"save\",\n        title: \"CONTROLS.SaveMacro\",\n        icon: \"fas fa-save\",\n        onClick: saveWeatherAndFiltersAsMacro,\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"clearfx\",\n        title: \"CONTROLS.ClearFX\",\n        icon: \"fas fa-trash\",\n        onClick: () => {\n          Dialog.confirm({\n            title: game.i18n.localize(\"FXMASTER.ClearWeatherAndFiltersTitle\"),\n            content: game.i18n.localize(\"FXMASTER.ClearWeatherAndFiltersContent\"),\n            yes: () => {\n              if (canvas.scene) {\n                filterManager.removeAll();\n                canvas.scene.unsetFlag(packageId, \"effects\");\n              }\n            },\n            defaultYes: true,\n          });\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n    ],\n  });\n}\n","// SPDX-License-Identifier: MIT\n// Copyright © 2021 fvtt-lib-wrapper Rui Pinheiro\n\n\"use strict\";\n\n// A shim for the libWrapper library\nexport let libWrapper = undefined;\n\nexport const VERSIONS = [1, 12, 1];\nexport const TGT_SPLIT_RE = new RegExp(\"([^.[]+|\\\\[('([^'\\\\\\\\]|\\\\\\\\.)+?'|\\\"([^\\\"\\\\\\\\]|\\\\\\\\.)+?\\\")\\\\])\", \"g\");\nexport const TGT_CLEANUP_RE = new RegExp(\"(^\\\\['|'\\\\]$|^\\\\[\\\"|\\\"\\\\]$)\", \"g\");\n\n// Main shim code\nHooks.once(\"init\", () => {\n  // Check if the real module is already loaded - if so, use it\n  if (globalThis.libWrapper && !(globalThis.libWrapper.is_fallback ?? true)) {\n    libWrapper = globalThis.libWrapper;\n    return;\n  }\n\n  // Fallback implementation\n  libWrapper = class {\n    static get is_fallback() {\n      return true;\n    }\n\n    static get WRAPPER() {\n      return \"WRAPPER\";\n    }\n    static get MIXED() {\n      return \"MIXED\";\n    }\n    static get OVERRIDE() {\n      return \"OVERRIDE\";\n    }\n\n    static register(package_id, target, fn, type = \"MIXED\", { chain = undefined, bind = [] } = {}) {\n      const is_setter = target.endsWith(\"#set\");\n      target = !is_setter ? target : target.slice(0, -4);\n      const split = target.match(TGT_SPLIT_RE).map((x) => x.replace(/\\\\(.)/g, \"$1\").replace(TGT_CLEANUP_RE, \"\"));\n      const root_nm = split.splice(0, 1)[0];\n\n      let obj, fn_name;\n      if (split.length == 0) {\n        obj = globalThis;\n        fn_name = root_nm;\n      } else {\n        const _eval = eval;\n        fn_name = split.pop();\n        obj = split.reduce((x, y) => x[y], globalThis[root_nm] ?? _eval(root_nm));\n      }\n\n      let iObj = obj;\n      let descriptor = null;\n      while (iObj) {\n        descriptor = Object.getOwnPropertyDescriptor(iObj, fn_name);\n        if (descriptor) break;\n        iObj = Object.getPrototypeOf(iObj);\n      }\n      if (!descriptor || descriptor?.configurable === false)\n        throw new Error(\n          `libWrapper Shim: '${target}' does not exist, could not be found, or has a non-configurable descriptor.`,\n        );\n\n      let original = null;\n      const wrapper =\n        chain ?? (type.toUpperCase?.() != \"OVERRIDE\" && type != 3)\n          ? function (...args) {\n              return fn.call(this, original.bind(this), ...bind, ...args);\n            }\n          : function (...args) {\n              return fn.call(this, ...bind, ...args);\n            };\n      if (!is_setter) {\n        if (descriptor.value) {\n          original = descriptor.value;\n          descriptor.value = wrapper;\n        } else {\n          original = descriptor.get;\n          descriptor.get = wrapper;\n        }\n      } else {\n        if (!descriptor.set) throw new Error(`libWrapper Shim: '${target}' does not have a setter`);\n        original = descriptor.set;\n        descriptor.set = wrapper;\n      }\n\n      descriptor.configurable = true;\n      Object.defineProperty(obj, fn_name, descriptor);\n    }\n  };\n\n  //************** USER CUSTOMIZABLE:\n  // Set up the ready hook that shows the \"libWrapper not installed\" warning dialog. Remove if undesired.\n  {\n    //************** USER CUSTOMIZABLE:\n    // Package ID & Package Title - by default attempts to auto-detect, but you might want to hardcode your package ID and title here to avoid potential auto-detect issues\n    const [PACKAGE_ID, PACKAGE_TITLE] = (() => {\n      const match = (import.meta?.url ?? Error().stack)?.match(/\\/(worlds|systems|modules)\\/(.+)(?=\\/)/i);\n      if (match?.length !== 3) return [null, null];\n      const dirs = match[2].split(\"/\");\n      if (match[1] === \"worlds\")\n        return dirs.find((n) => n && game.world.id === n) ? [game.world.id, game.world.title] : [null, null];\n      if (match[1] === \"systems\")\n        return dirs.find((n) => n && game.system.id === n) ? [game.system.id, game.system.data.title] : [null, null];\n      const id = dirs.find((n) => n && game.modules.has(n));\n      return [id, game.modules.get(id)?.data?.title];\n    })();\n\n    if (!PACKAGE_ID || !PACKAGE_TITLE) {\n      console.error(\n        \"libWrapper Shim: Could not auto-detect package ID and/or title. The libWrapper fallback warning dialog will be disabled.\",\n      );\n      return;\n    }\n\n    Hooks.once(\"ready\", () => {\n      //************** USER CUSTOMIZABLE:\n      // Title and message for the dialog shown when the real libWrapper is not installed.\n      const FALLBACK_MESSAGE_TITLE = PACKAGE_TITLE;\n      const FALLBACK_MESSAGE = `\n\t\t\t\t<p><b>'${PACKAGE_TITLE}' depends on the 'libWrapper' module, which is not present.</b></p>\n\t\t\t\t<p>A fallback implementation will be used, which increases the chance of compatibility issues with other modules.</p>\n\t\t\t\t<small><p>'libWrapper' is a library which provides package developers with a simple way to modify core Foundry VTT code, while reducing the likelihood of conflict with other packages.</p>\n\t\t\t\t<p>You can install it from the \"Add-on Modules\" tab in the <a href=\"javascript:game.shutDown()\">Foundry VTT Setup</a>, from the <a href=\"https://foundryvtt.com/packages/lib-wrapper\">Foundry VTT package repository</a>, or from <a href=\"https://github.com/ruipin/fvtt-lib-wrapper/\">libWrapper's Github page</a>.</p></small>\n\t\t\t`;\n\n      // Settings key used for the \"Don't remind me again\" setting\n      const DONT_REMIND_AGAIN_KEY = \"libwrapper-dont-remind-again\";\n\n      // Dialog code\n      console.warn(`${PACKAGE_TITLE}: libWrapper not present, using fallback implementation.`);\n      game.settings.register(PACKAGE_ID, DONT_REMIND_AGAIN_KEY, {\n        name: \"\",\n        default: false,\n        type: Boolean,\n        scope: \"world\",\n        config: false,\n      });\n      if (game.user.isGM && !game.settings.get(PACKAGE_ID, DONT_REMIND_AGAIN_KEY)) {\n        new Dialog({\n          title: FALLBACK_MESSAGE_TITLE,\n          content: FALLBACK_MESSAGE,\n          buttons: {\n            ok: { icon: '<i class=\"fas fa-check\"></i>', label: \"Understood\" },\n            dont_remind: {\n              icon: '<i class=\"fas fa-times\"></i>',\n              label: \"Don't remind me again\",\n              callback: () => game.settings.set(PACKAGE_ID, DONT_REMIND_AGAIN_KEY, true),\n            },\n          },\n        }).render(true);\n      }\n    });\n  }\n});\n","import { packageId } from \"../constants.js\";\nimport { libWrapper } from \"../shims/lib-wrapper.js\";\nimport { SpecialsLayer } from \"../specialEffects/SpecialsLayer.js\";\n\nexport function registerCanvasWrappers() {\n  const methods = [\"_onClickLeft\", \"_onDragLeftStart\", \"_onDragLeftMove\", \"_onDragLeftDrop\"];\n  for (const method of methods) {\n    libWrapper.register(packageId, `Canvas.prototype.${method}`, getWrapper(method), \"WRAPPER\");\n  }\n}\n\nfunction getWrapper(method) {\n  return function (wrapped, ...args) {\n    wrapped.call(this, ...args);\n    const layer = this.activeLayer;\n    if (layer instanceof SpecialsLayer) layer[method](...args);\n  };\n}\n","import { registerCanvasWrappers } from \"./canvas.js\";\n\nexport function registerWrappers() {\n  registerCanvasWrappers();\n}\n","import { registerSettings } from \"./settings.js\";\nimport { registerHooks } from \"./hooks.js\";\nimport { FXMASTER } from \"./config.js\";\nimport { WeatherLayer } from \"./weatherEffects/WeatherLayer.js\";\nimport { filterManager } from \"./filterEffects/FilterManager.js\";\nimport { executeWhenWorldIsMigratedToLatest, isOnTargetMigration, migrate } from \"./migration.js\";\nimport { SpecialsConfig } from \"./specialEffects/applications/specials-config.js\";\nimport { SpecialsLayer } from \"./specialEffects/SpecialsLayer.js\";\nimport { registerHelpers } from \"./helpers.js\";\nimport { registerGetSceneControlButtonsHook } from \"./controls.js\";\nimport { isV9OrLater } from \"./utils.js\";\nimport { logger } from \"./logger.js\";\nimport { registerWrappers } from \"./wrappers/index.js\";\n\nimport \"../css/common.css\";\n\nwindow.FXMASTER = {\n  filters: filterManager,\n};\n\nfunction registerLayer() {\n  CONFIG.Canvas.layers.fxmaster = isV9OrLater() ? { layerClass: WeatherLayer, group: \"primary\" } : WeatherLayer;\n  CONFIG.Canvas.layers.specials = isV9OrLater() ? { layerClass: SpecialsLayer, group: \"primary\" } : SpecialsLayer;\n}\n\nfunction parseSpecialEffects() {\n  const effectData = game.settings.get(\"fxmaster\", \"specialEffects\");\n  const specials = foundry.utils.deepClone(CONFIG.fxmaster.specials);\n  effectData.reduce((acc, cur) => {\n    if (!cur.folder) cur.folder = \"Custom\";\n    const normalizedFolder = cur.folder.toLowerCase().replace(/ /g, \"\");\n    if (!acc[normalizedFolder]) acc[normalizedFolder] = { label: cur.folder, effects: [] };\n    acc[normalizedFolder].effects.push(cur);\n    return acc;\n  }, specials);\n  Object.keys(specials).forEach((k) => {\n    specials[k].effects.sort((a, b) => (\"\" + a.label).localeCompare(b.label));\n  });\n  CONFIG.fxmaster.userSpecials = specials;\n}\n\nHooks.once(\"init\", function () {\n  // Register custom system settings\n  registerSettings();\n  registerHooks();\n  registerLayer();\n  registerWrappers();\n  registerHelpers();\n\n  // Adding filters, weathers and effects\n  if (!CONFIG.fxmaster) CONFIG.fxmaster = {};\n  foundry.utils.mergeObject(CONFIG.fxmaster, {\n    filters: FXMASTER.filters,\n    specials: FXMASTER.specials,\n    weather: FXMASTER.weatherEffects,\n  });\n\n  Object.defineProperty(CONFIG.fxmaster.weather, \"nature\", {\n    get: () => {\n      logger.warn(\n        `'CONFIG.fxmaster.weather.nature' is deprecated and will be removed in a future version. Please use 'CONFIG.fxmaster.weather.leaves' instead.`,\n      );\n      return CONFIG.fxmaster.weather.leaves;\n    },\n  });\n\n  foundry.utils.mergeObject(CONFIG.weatherEffects, FXMASTER.weatherEffects);\n});\n\nHooks.once(\"ready\", () => {\n  migrate();\n});\n\nHooks.on(\"canvasInit\", () => {\n  if (!game.settings.get(\"fxmaster\", \"enable\") || game.settings.get(\"fxmaster\", \"disableAll\")) {\n    return;\n  }\n  parseSpecialEffects();\n  filterManager.clear();\n});\n\nHooks.on(\"canvasReady\", async () => {\n  executeWhenWorldIsMigratedToLatest(async () => {\n    if (!game.settings.get(\"fxmaster\", \"enable\") || game.settings.get(\"fxmaster\", \"disableAll\")) {\n      return;\n    }\n    await filterManager.activate();\n  });\n});\n\nHooks.on(\"updateScene\", (scene, data) => {\n  if (\n    !game.settings.get(\"fxmaster\", \"enable\") ||\n    game.settings.get(\"fxmaster\", \"disableAll\") ||\n    !isOnTargetMigration() ||\n    scene !== canvas.scene\n  ) {\n    return;\n  }\n  if (hasProperty(data, \"flags.fxmaster.effects\") || hasProperty(data, \"flags.fxmaster.-=effects\")) {\n    canvas.fxmaster.drawWeather({ soft: true });\n  }\n  if (hasProperty(data, \"flags.fxmaster.invert\") || hasProperty(data, \"flags.fxmaster.-=invert\")) {\n    canvas.fxmaster.updateMask();\n  }\n  if (\n    hasProperty(data, \"flags.fxmaster.filters\") ||\n    hasProperty(data, \"flags.fxmaster.-=filters\") ||\n    hasProperty(data, \"flags.fxmaster.filteredLayers\") ||\n    hasProperty(data, \"flags.fxmaster.-=filteredLayers\")\n  ) {\n    filterManager.update();\n  }\n});\n\nHooks.on(\"dropCanvasData\", async (canvas, data) => {\n  if (!(canvas.activeLayer instanceof SpecialsLayer) || !canvas.scene) return;\n  if (data.type !== \"SpecialEffect\") return;\n\n  await new Promise((resolve) => {\n    const vid = document.createElement(\"video\");\n    vid.addEventListener(\n      \"loadedmetadata\",\n      () => {\n        data.width = vid.videoWidth * data.scale.x;\n        data.height = vid.videoHeight * data.scale.y;\n        resolve();\n      },\n      false,\n    );\n    vid.src = data.file;\n  });\n\n  const tileData = {\n    alpha: 1,\n    flags: {},\n    height: data.height,\n    hidden: false,\n    img: data.file,\n    locked: false,\n    occlusion: { mode: 1, alpha: 0 },\n    overHead: false,\n    rotation: 0,\n    tileSize: 100,\n    video: { loop: true, autoplay: true, volume: 0 },\n    width: data.width,\n    x: data.x - data.anchor.x * data.width,\n    y: data.y - data.anchor.y * data.height,\n    z: 100,\n  };\n  ui.notifications.info(`A new Tile was created for effect ${data.label}`);\n  canvas.scene.createEmbeddedDocuments(\"Tile\", [tileData]).then(() => {});\n});\n\nHooks.on(\"hotbarDrop\", (hotbar, data) => {\n  if (data.type !== \"SpecialEffect\") return;\n  const macroCommand = SpecialsLayer._createMacro(data);\n  data.type = \"Macro\";\n  data.data = {\n    command: macroCommand,\n    name: data.label,\n    type: \"script\",\n    author: game.user.id,\n  };\n});\n\nHooks.on(\"updateDrawing\", (drawing) => {\n  if (drawing.parent !== canvas.scene) {\n    return;\n  }\n  canvas.fxmaster.updateMask();\n});\n\nHooks.on(\"createDrawing\", (drawing) => {\n  if (drawing.parent !== canvas.scene) {\n    return;\n  }\n  canvas.fxmaster.updateMask();\n});\n\nHooks.on(\"deleteDrawing\", (drawing) => {\n  if (drawing.parent !== canvas.scene) {\n    return;\n  }\n  canvas.fxmaster.updateMask();\n});\n\nHooks.on(\"updateSetting\", (data) => {\n  if (data.data.key === \"fxmaster.specialEffects\") {\n    parseSpecialEffects();\n  }\n  Object.values(ui.windows).forEach((w) => {\n    if (w instanceof SpecialsConfig) {\n      w.render(false);\n    }\n  });\n});\n\nHooks.on(\"renderDrawingHUD\", (hud, html, data) => {\n  const maskToggle = document.createElement(\"div\");\n  maskToggle.classList.add(\"control-icon\");\n  if (data?.flags?.fxmaster?.masking) {\n    maskToggle.classList.add(\"active\");\n  }\n  maskToggle.setAttribute(\"title\", game.i18n.localize(\"FXMASTER.MaskWeather\"));\n  maskToggle.dataset.action = \"mask\";\n  maskToggle.innerHTML = \"<i class='fas fa-cloud'></i>\";\n  html.find(\".col.left\").append(maskToggle);\n\n  html.find(\".control-icon[data-action='mask']\").click(async () => {\n    await hud.object.document.setFlag(\"fxmaster\", \"masking\", !data?.flags?.fxmaster?.masking);\n    hud.render(true);\n  });\n});\n\nregisterGetSceneControlButtonsHook();\n","export const registerHelpers = function () {\n  Handlebars.registerHelper(\"parameter\", (effectCls, parameterConfig, parameterName, options = {}) => {\n    const _default = options[parameterName] ?? effectCls.default[parameterName];\n\n    switch (parameterConfig.type) {\n      case \"color\":\n        return `\n              <input type=\"checkbox\" name=\"${effectCls.label}_${parameterName}_apply\" ${\n          _default.apply ? \"checked\" : \"\"\n        }/>\n              <input type=\"color\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default.value}\">\n              `;\n      case \"range\":\n        return `\n              <input class=\"fxmaster-range-input\" type=\"range\" step=\"${parameterConfig.step}\" min=\"${parameterConfig.min}\" max=\"${parameterConfig.max}\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default}\">\n              <span class=\"range-value\">${_default}</span>\n              `;\n      case \"number\":\n        return `\n              <input class=\"fxmaster-text-input\" type=\"text\" data-dtype=\"Number\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default}\">\n              `;\n      case \"multi-select\":\n        return `<select class=\"fxmaster-multi-select\" multiple name=\"${\n          effectCls.label\n        }_${parameterName}\">${Object.entries(parameterConfig.options).map(\n          ([key, name]) =>\n            `<option class=\"fxmaster-multi-select__option\" value=\"${key}\"${\n              _default.includes(key) ? \" selected\" : \"\"\n            }>${game.i18n.localize(name)}</option>`,\n        )}</select>`;\n    }\n    return \"\";\n  });\n};\n"],"names":["packageId","getLoggingFunction","type","log","console","data","logger","Object","freeze","debug","info","warn","error","resetFlags","document","flaglabel","newFlags","oldFlags","getFlag","keys","forEach","k","setFlag","formatString","format","args","replace","match","number","isV9OrLater","game","release","generation","roundToDecimals","decimals","Number","Math","round","async","migrate","migrateClient","migration","settings","get","set","ui","notifications","permanent","localize","isError","migrateClient0to1","effects","i","length","scale","x","y","user","isGM","migrateWolrd","migrateWorld1to2","migrateScene","scene","weatherEffects","newWeatherEffects","fromEntries","entries","map","id","effect","weatherEffectClass","CONFIG","fxmaster","weather","options","convertOptionsToV2","scenes","name","e","migrateSceneCompendium","pack","metadata","entity","wasLocked","locked","configure","getDocuments","collection","packs","package","isOnTargetMigration","executeWhenWorldIsMigratedToLatest","callback","worldMigrationCallbacks","push","onWorldMigrated","debouncedReload","foundry","utils","debounce","window","location","reload","onSwitchWeather","parameters","canvas","newEffect","flags","hasProperty","mergeObject","unsetFlag","onUpdateWeather","parametersArray","randomID","deprecationFormatString","onSwitchWeatherDeprecated","v2Parameters","onUpdateWeatherDeprecated","v2ParametersArray","AbstractWeatherEffect","SpecialEffect","group","icon","label","min","value","max","step","direction","this","startRotation","speed","lifetime","density","tint","apply","default","parameterName","parameterConfig","effectOptions","optionTypeMapping","color","OPTION_TYPES","VALUE","range","RANGE","applyOptionsToConfig","config","_applyScaleToConfig","_applySpeedToConfig","_applyDirectionToConfig","_applyLifetimeToConfig","_applyTintToConfig","_applyFactorToBasicTweenableOrValueListOrRandNumber","basicTweenableOrValueListOrRandNumber","factor","start","end","list","valueStep","dimensions","size","lifeTime","frequency","undefined","time","timeout","emitterPromises","emitters","emitter","Promise","resolve","emitterLifetime","playOnceAndDestroy","promises","all","setTimeout","race","stop","static","optionKey","optionValue","_convertScaleToV2","_convertSpeedToV2","_convertDensityToV2","speeds","maximumSpeed","d","width","height","BubblesWeatherEffect","super","getParticleEmitters","_getBubbleEmitter","parent","p","constructor","spawnRect","sceneRect","w","h","maxParticles","inplace","PIXI","particles","Emitter","DEFAULT_CONFIG","alpha","minimumScaleMultiplier","minimumSpeedMultiplier","rotationSpeed","blendMode","CloudsWeatherEffect","_getCloudEmitter","offsetFactor","averageDiagonalTime","sqrt","minLifetime","maxLifetime","angle","toRadians","directionVector","cos","sin","isStepped","EmbersWeatherEffect","_getEmbersEmitter","startColor","ParticleUtils","createSteppedGradient","CrowsWeatherEffect","_getCrowsEmitter","framerate","textures","texture","count","loop","particleConstructor","AnimatedParticle","BatsWeatherEffect","_getBatsEmitter","FogWeatherEffect","_getFogEmitter","RaintopWeatherEffect","_getEmitter","sceneRadius","sceneWidth","sceneHeight","spawnType","spawnCircle","r","minR","RainSimpleWeatherEffect","_getRainEmitter","SnowstormWeatherEffect","_getSnowEmitter","PathParticle","extraData","path","BirdsWeatherEffect","animations","glide","flap","mixed","textureNumber","Array","fill","deepFlatten","getAnim","animation","textureFormatString","anims","filter","includes","StarsWeatherEffect","RainWeatherEffect","noRotation","_getSplashEmitter","SPLASH_CONFIG","SnowWeatherEffect","AutumnLeavesWeatherEffect","rotation","_getLeafEmitter","sprites","fromRange","n","SpiderWeatherEffect","_getSpidersEmitter","anim_sheet","String","padStart","EaglesWeatherEffect","_textures","_initializeTextures","_textureCache","spriteSheetTexture","Texture","from","spriteSheetData","meta","frames","frame","rotated","trimmed","spriteSourceSize","sourceSize","Spritesheet","parse","values","RatsWeatherEffect","index","weatherDB","bats","birds","crows","eagles","rats","spiders","bubbles","embers","stars","leaves","clouds","fog","rain","raintop","rainsimple","snow","snowstorm","FXColorFilter","filters","AdjustmentFilter","enabled","skipFading","faIcon","saturation","contrast","brightness","gamma","zeros","red","green","blue","opts","colors","hexToRGB","colorStringToHex","applyOptions","key","animateOptions","duration","anim","reduce","arr","attribute","to","CanvasAnimation","animateLinear","play","finally","FXUnderwaterFilter","DisplacementFilter","dizzyMap","Sprite","speedConfig","baseTexture","wrapMode","WRAP_MODES","REPEAT","anchor","maskSprite","background","addChild","defaults","removeChild","FXCanvasAnimation","attributes","context","ontick","ease","a","delta","done","remaining","stage","_animatePromise","_animateFrameSmooth","deltaTime","reject","complete","dt","TARGET_FPMS","da","abs","progress","err","easeFunctions","Linear","easeLinear","InSine","easeInSine","PI","OutSine","easeOutSine","InOutSine","easeInOutSine","InBack","easeInBack","c1","OutBack","easeOutBack","pow","InOutBack","easeInOutBack","c2","InCubic","easeInCubic","OutCubic","easeOutCubic","InOutCubic","easeInOutCubic","InCirc","easeInCirc","OutCirc","easeOutCirc","InOutCirc","easeInOutCirc","FXLightningFilter","next","app","ticker","lastTime","spark_duration","random","animate","target","animateSmooth","then","merged","FXPredatorFilter","CRTFilter","vignetting","curvature","noise","period","lineWidth","seed","FXOldFilmFilter","OldFilmFilter","vignettingAlpha","sepia","FXBloomFilter","AdvancedBloomFilter","blur","bloomScale","threshold","terminateAnimation","FXMASTER","bloom","lightning","oldfilm","predator","underwater","specials","file","author","Graphics","LegacyGraphics","WeatherLayer","CanvasLayer","_sceneMask","_sceneMaskFilter","layerOptions","zIndex","shouldMaskToScene","img","_createInvertedMask","mask","drawings","placeables","drawing","beginFill","shape","geometry","graphicsData","clone","CONST","DRAWING_TYPES","ELLIPSE","center","drawShape","POLYGON","FREEHAND","points","acc","v","drawPolygon","endFill","_createMask","rect","beginHole","endHole","updateMask","destroy","Hooks","callAll","fx","tearDown","_draw","bind","_drawSceneMask","_createSceneMaskFilter","drawWeather","soft","Container","stopPromise","fadeOut","optionName","cachedContainer","CachedContainer","intersectRectangles","b","outRect","Rectangle","x0","x1","right","y0","y1","bottom","sceneMaskFilter","InverseOcclusionMaskFilter","create","alphaOcclusion","uMaskSampler","renderTexture","_setLayerMask","_createInvertMask","FilterManager","filterInfos","_ticker","filteredLayers","foreground","tokens","update","add","_animate","filterInfo","filtersToCreate","filtersToUpdate","filtersToDelete","deletePromises","layer","_removeFilterFromContainer","applyFiltersToLayers","layerName","filtered","otherFilters","f","concat","container","dump","rmFilter","removeFilter","addFilter","filterInfoArray","apply_to","filterManager","SpecialCreate","FormApplication","defaultOptions","classes","closeOnSubmit","submitOnChange","submitOnClose","popOut","editable","template","title","i18n","setDefault","object","getData","eases","folder","position","animationDelay","preset","activateListeners","html","find","on","event","_onChangeRange","_","formData","fxs","newData","parseFloat","SpecialsConfig","Application","resizable","dragDrop","dragSelector","folders","userSpecials","click","currentTarget","closest","items","$","classList","remove","parentElement","render","hover","ev","folderId","dataset","effectId","findIndex","splice","c","children","_toggleFolder","hasClass","removeClass","addClass","_onDragStart","effectData","dataTransfer","setData","JSON","stringify","SpecialsLayer","videos","_dragging","ruler","windowVisible","socket","playVideo","draw","visible","video","_configureProjectile","vidSprite","distance","deltaX","deltaY","animationDuration","_configureRotate","_configureSprite","normalizeRadians","keepAspect","aspectRatio","playbackRate","createElement","preload","crossOrigin","src","oncanplay","videoWidth","videoHeight","onerror","onended","drawSpecialToward","tok1","tok2","origin","ray","Ray","emit","drawFacing","_drawSpecial","savedOrigin","stopPropagation","effectConfig","windows","active","element","deepClone","destination","mode","action","grid","_onDragLeftDrop","u","hypot","acos","clear","_onDragLeftStart","_isWindowVisible","_onDragLeftMove","lineStyle","drawCircle","A","moveTo","lineTo","B","_onClickLeft","FXMasterBaseForm","_onClickCollapse","parentClass","collapsibleClass","iconClass","parentItem","parents","collapsible","_collapse","collapsedClass","slideUp","slideDown","prop","_onChangeInput","_onSubmit","WeatherConfig","currentParticleEffects","activeParticleEffects","weatherEffectGroups","sort","clsA","clsB","localeCompare","groups","cls","titleCase","expanded","activeEffects","weathersDB","weatherCls","weatherName","parameter","FiltersConfig","currentFilters","activeFilters","filtersDB","filterCls","filterName","defaultMacroImg","saveWeatherAndFiltersAsMacro","weatherFlags","filterFlags","filterEffects","getMacroNameAndImg","weatherLabelsAndIcons","flatMap","weatherEffectCls","filterLabels","filterEffectCls","commands","command","join","Macro","getSceneControlButtons","controls","role","tools","onClick","button","invert","toggle","Dialog","confirm","content","yes","removeAll","defaultYes","libWrapper","TGT_SPLIT_RE","RegExp","TGT_CLEANUP_RE","getWrapper","method","wrapped","call","activeLayer","registerWrappers","registerCanvasWrappers","methods","register","parseSpecialEffects","cur","normalizedFolder","toLowerCase","once","globalThis","is_fallback","WRAPPER","MIXED","OVERRIDE","package_id","fn","chain","is_setter","endsWith","split","slice","root_nm","obj","fn_name","_eval","eval","pop","iObj","descriptor","getOwnPropertyDescriptor","getPrototypeOf","configurable","Error","original","wrapper","toUpperCase","defineProperty","PACKAGE_ID","PACKAGE_TITLE","import","url","stack","dirs","world","system","modules","has","FALLBACK_MESSAGE_TITLE","FALLBACK_MESSAGE","DONT_REMIND_AGAIN_KEY","Boolean","scope","buttons","ok","dont_remind","onChange","hint","USER_ROLES","ASSISTANT","choices","PLAYER","TRUSTED","GAMEMASTER","registerLayer","Canvas","layers","layerClass","Handlebars","registerHelper","effectCls","_default","activate","vid","addEventListener","tileData","hidden","occlusion","overHead","tileSize","autoplay","volume","z","createEmbeddedDocuments","hotbar","macroCommand","_createMacro","hud","maskToggle","masking","setAttribute","innerHTML","append","registerGetSceneControlButtonsHook"],"mappings":"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"}