const ITEM_UUID=checkFeat("mountain-quake")?"Compendium.pf2e.feat-effects.wuERa7exfXXl6I37":checkFeat("mountain-stronghold")?"Compendium.pf2e.feat-effects.LXbVcutEIW8eWZEz":checkFeat("mountain-stance")?"Compendium.pf2e.feat-effects.gYpy9XBPScIlY93p":null;function checkFeat(slug){return!!token?.actor?.itemTypes.feat.some((i=>i.slug===slug))}"character"!==token?.actor?.type?ui.notifications.error("PF2e System | Select exactly one player-character token."):null===ITEM_UUID?ui.notifications.warn(`PF2e System | ${token.actor.name} does not have the Mountain Stance feat`):await async function(effectUUID){const{actor}=token,{itemTypes}=actor,existing=itemTypes.effect.find((e=>e.sourceId===effectUUID));if(existing)return void await actor.deleteEmbeddedDocuments("Item",[existing.id]);const effect=(await fromUuid(effectUUID)).toObject();effect.flags.core=effect.flags.core??{},effect.flags.core.sourceId=effect.flags.core.sourceId??effectUUID;const clothingBonus=itemTypes.armor.find((i=>"clothing-explorers"===i.slug&&i.isEquipped))?.data.data.runes.potency??0,bracers=itemTypes.equipment.find((i=>i.isInvested&&i.slug.startsWith("bracers-of-armor-"))),bracersBonus=bracers?bracers.slug.endsWith("-i")?1:bracers.slug.endsWith("-ii")?2:3:0,mageArmor=itemTypes.effect.find((i=>"spell-effect-mage-armor"===i.slug)),mageArmorBonus=mageArmor?10===mageArmor.level?3:mageArmor.level>=5?2:1:0,itemBonus=Math.max(clothingBonus,bracersBonus,mageArmorBonus),rule=effect.data.rules.find((r=>"ac"===r.selector&&"FlatModifier"===r.key));rule.value=rule.value+itemBonus,await actor.createEmbeddedDocuments("Item",[effect])}(ITEM_UUID);